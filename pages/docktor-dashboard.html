<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NeuroTrack Doctor Dashboard">
    <title>Doctor Dashboard | NeuroTrack</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;450;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="../assets/css/doctor-theme.css">
    <!-- Chart.js for KPI visualizations (local copy to avoid tracking prevention) -->
    <script src="../assets/js/chart.min.js"></script>
</head>
<body>
    <!-- Header Navigation -->
    <header class="dashboard-header">
        <div class="header-container">
            <!-- Logo with Branding -->
            <a href="#" class="header-logo" aria-label="Neuro Track Home">
                <img src="../assets/img/logo.png" alt="NeuroTrack Logo" class="header-logo__image">
                <span class="header-logo__text">Neuro<span>Track</span></span>
            </a>

            <!-- Navigation Links -->
            <nav class="header-nav" role="navigation" aria-label="Main navigation">
                <a href="#" class="header-nav__link" onclick="showSection('dashboard'); return false;" aria-current="page">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 6px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    Dashboard
                </a>
                <a href="#" class="header-nav__link" onclick="showSection('schedule'); return false;">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 6px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Schedule
                </a>
                <a href="#" class="header-nav__link" onclick="showSection('messages'); return false;">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 6px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                    Messages
                </a>
            </nav>

            <!-- Actions -->
            <div class="header-actions">
                <!-- Notification Bell -->
                <div style="position: relative;">
                    <button class="header-notification" aria-label="Notifications" title="Notifications" onclick="toggleNotifications()">
                        <svg class="notification-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                        </svg>
                        <span class="header-notification__badge"></span>
                    </button>
                    
                    <!-- Notification Dropdown -->
                    <div class="notification-dropdown" id="notificationDropdown" role="menu" aria-label="Notifications">
                        <div class="notification-dropdown__header">
                            <span class="notification-dropdown__title">Notifications</span>
                            <span class="notification-dropdown__count">6</span>
                        </div>
                        <div class="notification-dropdown__list" id="notificationList" role="list">
                            <!-- Notifications will be inserted here by JavaScript -->
                        </div>
                        <div class="notification-dropdown__footer">
                            <a href="#" onclick="return false;">View all notifications</a>
                        </div>
                    </div>
                </div>

                <!-- User Profile - Clickable to open profile -->
                <div class="header-user" 
                     onclick="showSection('profile')" 
                     role="button" 
                     tabindex="0"
                     aria-label="Open profile"
                     onkeydown="if(event.key==='Enter'||event.key===' '){showSection('profile');event.preventDefault();}">
                    <div class="header-user__info">
                        <div class="header-user__name" id="userName">Dr. Dokter</div>
                        <div class="header-user__role" id="userRole">Doctor</div>
                    </div>
                    <div class="header-user__avatar" id="userAvatar">
                        D
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Doctor Profile Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-modal__overlay" onclick="closeProfileModal()"></div>
        <div class="profile-modal__panel">
            <div class="profile-modal__header">
                <h2 class="profile-modal__title">Doctor Profile</h2>
                <button class="profile-modal__close" onclick="closeProfileModal()" aria-label="Close profile">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="profile-modal__content">
                <!-- Profile Photo Section -->
                <div class="profile-photo-section">
                    <div class="profile-photo-wrapper">
                        <div class="profile-photo" id="profilePhoto">
                            <span id="profilePhotoInitial">D</span>
                        </div>
                        <div class="profile-photo-status"></div>
                    </div>
                    <h3 class="profile-name" id="profileName">Dr. Dokter</h3>
                    <p class="profile-role-badge" id="profileRoleBadge">Doctor</p>
                </div>

                <!-- Profile Information Cards -->
                <div class="profile-info-section">
                    <h4 class="profile-section-title">Personal Information</h4>
                    
                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Email Address</span>
                                <span class="profile-info-value" id="profileEmail">dokter@neurotrack.com</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Username</span>
                                <span class="profile-info-value" id="profileUsername">dokter</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Specialization</span>
                                <span class="profile-info-value" id="profileSpecialization">Neurology</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">License ID</span>
                                <span class="profile-info-value" id="profileLicense">MD-123456</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Hospital Affiliation</span>
                                <span class="profile-info-value" id="profileHospital">General Hospital</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Activity -->
                <div class="profile-info-section">
                    <h4 class="profile-section-title">Account Activity</h4>
                    
                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Last Login</span>
                                <span class="profile-info-value" id="profileLastLogin">Just now</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-info-card">
                        <div class="profile-info-item">
                            <div class="profile-info-icon">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="profile-info-content">
                                <span class="profile-info-label">Member Since</span>
                                <span class="profile-info-value" id="profileCreatedAt">December 2025</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logout Button -->
                <div class="profile-actions">
                    <button class="btn-logout" onclick="handleLogout()">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/>
                        </svg>
                        <span>Log Out</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="dashboard-main">
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="content-section">
                <div class="dashboard-page-wrapper">
                    <!-- Dashboard Sidebar -->
                    <aside class="sidebar sidebar--fixed dashboard-sidebar-nav" id="dashboardSidebarNav">
                        <div class="sidebar__header">
                            <h3 class="sidebar__title">Navigation</h3>
                            <button class="sidebar__toggle" id="dashboardSidebarToggle" onclick="toggleDashboardSidebar()" aria-label="Toggle sidebar">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
                                </svg>
                            </button>
                        </div>
                        
                        <nav class="sidebar__nav">
                            <button class="sidebar__item active" data-view="patient-dashboard" onclick="switchSidebarView('patient-dashboard')">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                </svg>
                                <span class="sidebar__item-text">Patient Dashboard</span>
                            </button>
                            <button class="sidebar__item" data-view="patient-list" onclick="switchSidebarView('patient-list')">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                </svg>
                                <span class="sidebar__item-text">Patient List</span>
                            </button>
                            <button class="sidebar__item" data-view="files" onclick="switchSidebarView('files')">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                                </svg>
                                <span class="sidebar__item-text">Files</span>
                            </button>
                        </nav>
                        
                        <div class="sidebar__footer">
                            <div class="sidebar__quick-stats">
                                <div class="quick-stat">
                                    <span class="quick-stat__value" id="sidebarPatientCount">10</span>
                                    <span class="quick-stat__label">Patients</span>
                                </div>
                                <div class="quick-stat">
                                    <span class="quick-stat__value" id="sidebarFileCount">25</span>
                                    <span class="quick-stat__label">Files</span>
                                </div>
                            </div>
                        </div>
                    </aside>

                    <!-- Dashboard Main Content -->
                    <div class="dashboard-main-content">
                        <!-- Patient Dashboard View -->
                        <div id="patientDashboardView" class="dashboard-view">
                            <div class="view-header">
                                <div class="view-header__left">
                                    <h1 class="view-header__title">Patient Dashboard</h1>
                                    <p class="view-header__subtitle">Monitor patient rehabilitation progress and KPIs</p>
                                </div>
                                <div class="view-header__actions">
                                    <div class="patient-selector">
                                        <label for="patientSelect" class="patient-selector__label">Select Patient:</label>
                                <select id="patientSelect" class="patient-selector__dropdown" onchange="loadPatientDashboard(this.value)">
                                    <option value="">-- Choose a patient --</option>
                                </select>
                            </div>
                            <div class="view-actions">
                                <button class="btn btn--secondary" onclick="exportPatientPDF()" disabled id="exportPdfBtn">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    Export PDF
                                </button>
                                <button class="btn btn--secondary" onclick="addPatientNote()" disabled id="addNoteBtn">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                    Add Note
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="patientDashboardEmpty" class="empty-state">
                        <div class="empty-state__icon">
                            <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                        </div>
                        <h3 class="empty-state__title">Select a Patient</h3>
                        <p class="empty-state__description">Choose a patient from the dropdown above to view their rehabilitation dashboard with KPIs and progress charts.</p>
                    </div>
                    
                    <!-- Patient Dashboard Content -->
                    <div id="patientDashboardContent" class="patient-dashboard" style="display: none;">
                        <!-- Patient Info Banner -->
                        <div class="patient-banner" id="patientBanner">
                            <div class="patient-banner__avatar" id="patientAvatar">A</div>
                            <div class="patient-banner__info">
                                <h2 class="patient-banner__name" id="patientName">Alice Tan</h2>
                                <p class="patient-banner__diagnosis" id="patientDiagnosis">Ischemic Stroke - Left MCA Territory</p>
                                <div class="patient-banner__meta">
                                    <span class="patient-banner__meta-item">
                                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                        </svg>
                                        Admitted: <span id="patientAdmission">Aug 10, 2025</span>
                                    </span>
                                    <span class="patient-banner__meta-item">
                                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                        </svg>
                                        Physio: <span id="patientPhysio">Dr. Sarah Wong</span>
                                    </span>
                                    <span class="patient-banner__status active" id="patientStatus">Active</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- KPI Cards -->
                        <div class="kpi-grid">
                            <div class="kpi-card" id="kpiMobility">
                                <div class="kpi-card__header">
                                    <div class="kpi-card__icon kpi-card__icon--mobility">
                                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                        </svg>
                                    </div>
                                    <div class="kpi-card__trend up" id="mobilityTrend">
                                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                        </svg>
                                        +5%
                                    </div>
                                </div>
                                <div class="kpi-card__value" id="mobilityValue">72</div>
                                <div class="kpi-card__label">Mobility Score</div>
                                <div class="kpi-card__progress">
                                    <div class="kpi-card__progress-bar" id="mobilityProgress" style="width: 72%;"></div>
                                </div>
                            </div>
                            
                            <div class="kpi-card" id="kpiADL">
                                <div class="kpi-card__header">
                                    <div class="kpi-card__icon kpi-card__icon--adl">
                                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="kpi-card__trend up" id="adlTrend">
                                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                        </svg>
                                        +3%
                                    </div>
                                </div>
                                <div class="kpi-card__value" id="adlValue">68<span class="kpi-card__unit">%</span></div>
                                <div class="kpi-card__label">ADL Independence</div>
                                <div class="kpi-card__progress">
                                    <div class="kpi-card__progress-bar kpi-card__progress-bar--adl" id="adlProgress" style="width: 68%;"></div>
                                </div>
                            </div>
                            
                            <div class="kpi-card" id="kpiAdherence">
                                <div class="kpi-card__header">
                                    <div class="kpi-card__icon kpi-card__icon--adherence">
                                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                    </div>
                                    <div class="kpi-card__trend stable" id="adherenceTrend">
                                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd"/>
                                        </svg>
                                        0%
                                    </div>
                                </div>
                                <div class="kpi-card__value" id="adherenceValue">95<span class="kpi-card__unit">%</span></div>
                                <div class="kpi-card__label">Therapy Adherence</div>
                                <div class="kpi-card__progress">
                                    <div class="kpi-card__progress-bar kpi-card__progress-bar--adherence" id="adherenceProgress" style="width: 95%;"></div>
                                </div>
                            </div>
                            
                            <div class="kpi-card" id="kpiPain">
                                <div class="kpi-card__header">
                                    <div class="kpi-card__icon kpi-card__icon--pain">
                                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                        </svg>
                                    </div>
                                    <div class="kpi-card__trend down" id="painTrend">
                                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                        </svg>
                                        -2
                                    </div>
                                </div>
                                <div class="kpi-card__value" id="painValue">3<span class="kpi-card__unit">/10</span></div>
                                <div class="kpi-card__label">Pain Level</div>
                                <div class="kpi-card__progress">
                                    <div class="kpi-card__progress-bar kpi-card__progress-bar--pain" id="painProgress" style="width: 30%;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Charts Grid -->
                        <div class="charts-grid">
                            <!-- Mobility Progress Line Chart -->
                            <div class="chart-card chart-card--large">
                                <div class="chart-card__header">
                                    <h3 class="chart-card__title">Mobility Progress Over Time</h3>
                                    <div class="chart-card__legend">
                                        <span class="legend-item"><span class="legend-dot legend-dot--primary"></span>Mobility Score</span>
                                    </div>
                                </div>
                                <div class="chart-card__body">
                                    <canvas id="mobilityChart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Therapy Attendance Bar Chart -->
                            <div class="chart-card">
                                <div class="chart-card__header">
                                    <h3 class="chart-card__title">Therapy Attendance</h3>
                                    <div class="chart-card__legend">
                                        <span class="legend-item"><span class="legend-dot legend-dot--primary"></span>Scheduled</span>
                                        <span class="legend-item"><span class="legend-dot legend-dot--secondary"></span>Attended</span>
                                    </div>
                                </div>
                                <div class="chart-card__body">
                                    <canvas id="attendanceChart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Strength & ROM Radar Chart -->
                            <div class="chart-card">
                                <div class="chart-card__header">
                                    <h3 class="chart-card__title">Strength & Range of Motion</h3>
                                </div>
                                <div class="chart-card__body">
                                    <canvas id="strengthChart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Gait Speed Line Chart -->
                            <div class="chart-card">
                                <div class="chart-card__header">
                                    <h3 class="chart-card__title">Gait Speed Progress</h3>
                                    <div class="chart-card__legend">
                                        <span class="legend-item"><span class="legend-dot legend-dot--secondary"></span>m/s</span>
                                    </div>
                                </div>
                                <div class="chart-card__body">
                                    <canvas id="gaitChart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Pain Trend Area Chart -->
                            <div class="chart-card">
                                <div class="chart-card__header">
                                    <h3 class="chart-card__title">Pain Level Trend</h3>
                                    <div class="chart-card__legend">
                                        <span class="legend-item"><span class="legend-dot legend-dot--danger"></span>Pain (0-10)</span>
                                    </div>
                                </div>
                                <div class="chart-card__body">
                                    <canvas id="painChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Notes Section -->
                        <div class="notes-section">
                            <div class="notes-section__header">
                                <h3 class="notes-section__title">Recent Clinical Notes</h3>
                                <button class="btn btn--sm btn--outline" onclick="viewAllNotes()">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                    View All
                                </button>
                            </div>
                            <div class="notes-section__content" id="recentNotes">
                                <p class="note-text">Patient showing excellent progress in gait training. Able to walk 50m with walker independently.</p>
                            </div>
                        </div>
                        
                        <!-- Quick Actions Panel -->
                        <div class="quick-actions-panel">
                            <h3 class="quick-actions__title">Quick Actions</h3>
                            <div class="quick-actions__grid">
                                <button class="quick-action-btn" onclick="scheduleAppointment()">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    <span>Schedule Appointment</span>
                                </button>
                                <button class="quick-action-btn" onclick="requestLabWork()">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                    </svg>
                                    <span>Request Lab Work</span>
                                </button>
                                <button class="quick-action-btn" onclick="sendMessage()">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                    </svg>
                                    <span>Send Message</span>
                                </button>
                                <button class="quick-action-btn" onclick="generateReport()">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    <span>Generate Report</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Patient List View -->
                <div id="patientListView" class="dashboard-view" style="display: none;">
                    <div class="view-header">
                        <div class="view-header__left">
                            <h1 class="view-header__title">Patient List</h1>
                            <p class="view-header__subtitle">View and manage all patients under your care</p>
                        </div>
                        <div class="view-header__actions">
                            <div class="search-box">
                                <svg class="search-box__icon" width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                </svg>
                                <input type="text" class="search-box__input" id="patientSearchInput" placeholder="Search patients..." oninput="filterPatientList(this.value)">
                            </div>
                            <div class="filter-buttons">
                                <button class="filter-btn active" data-status="all" onclick="filterPatientsByStatus('all')">All</button>
                                <button class="filter-btn" data-status="active" onclick="filterPatientsByStatus('active')">Active</button>
                                <button class="filter-btn" data-status="stable" onclick="filterPatientsByStatus('stable')">Stable</button>
                                <button class="filter-btn" data-status="critical" onclick="filterPatientsByStatus('critical')">Critical</button>
                            </div>
                            <button class="btn btn--primary" onclick="addNewPatient()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                Add Patient
                            </button>
                        </div>
                    </div>
                    
                    <!-- Patient Stats Summary -->
                    <div class="patient-stats-summary">
                        <div class="stat-card stat-card--total">
                            <div class="stat-card__icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <div class="stat-card__info">
                                <span class="stat-card__value" id="totalPatientsCount">10</span>
                                <span class="stat-card__label">Total Patients</span>
                            </div>
                        </div>
                        <div class="stat-card stat-card--active">
                            <div class="stat-card__icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <div class="stat-card__info">
                                <span class="stat-card__value" id="activePatientsCount">6</span>
                                <span class="stat-card__label">Active</span>
                            </div>
                        </div>
                        <div class="stat-card stat-card--stable">
                            <div class="stat-card__icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10a7 7 0 0114 0v5a7 7 0 01-14 0v-5z M12 17v4m-4-2h8"/>
                                </svg>
                            </div>
                            <div class="stat-card__info">
                                <span class="stat-card__value" id="stablePatientsCount">3</span>
                                <span class="stat-card__label">Stable</span>
                            </div>
                        </div>
                        <div class="stat-card stat-card--critical">
                            <div class="stat-card__icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                            </div>
                            <div class="stat-card__info">
                                <span class="stat-card__value" id="criticalPatientsCount">1</span>
                                <span class="stat-card__label">Critical</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="patient-list-container">
                        <!-- Patient Grid -->
                        <div class="patient-grid" id="patientGrid">
                            <!-- Patient cards will be rendered here -->
                        </div>
                        
                        <!-- Patient Profile Panel -->
                        <div class="patient-profile-panel" id="patientProfilePanel">
                            <div class="patient-profile-panel__empty">
                                <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                <p>Select a patient to view their profile</p>
                            </div>
                            <div class="patient-profile-panel__content" id="patientProfileContent" style="display: none;">
                                <!-- Profile content will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Files View -->
                <div id="filesView" class="dashboard-view" style="display: none;">
                    <div class="view-header">
                        <div class="view-header__left">
                            <h1 class="view-header__title">Files Manager</h1>
                            <p class="view-header__subtitle">Manage patient documents, videos, and reports</p>
                        </div>
                        <div class="view-header__actions">
                            <div class="search-box">
                                <svg class="search-box__icon" width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                </svg>
                                <input type="text" class="search-box__input" id="fileSearchInput" placeholder="Search files..." oninput="filterFiles(this.value)">
                            </div>
                            <button class="btn btn--secondary" onclick="createNewFolder()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                                </svg>
                                New Folder
                            </button>
                            <button class="btn btn--primary" onclick="uploadFile()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                                </svg>
                                Upload
                            </button>
                        </div>
                    </div>
                    
                    <!-- Storage Stats -->
                    <div class="storage-stats">
                        <div class="storage-stat">
                            <div class="storage-stat__icon storage-stat__icon--documents">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <div class="storage-stat__info">
                                <span class="storage-stat__value">17</span>
                                <span class="storage-stat__label">Documents</span>
                            </div>
                        </div>
                        <div class="storage-stat">
                            <div class="storage-stat__icon storage-stat__icon--images">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            <div class="storage-stat__info">
                                <span class="storage-stat__value">7</span>
                                <span class="storage-stat__label">Images/Scans</span>
                            </div>
                        </div>
                        <div class="storage-stat">
                            <div class="storage-stat__icon storage-stat__icon--videos">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            <div class="storage-stat__info">
                                <span class="storage-stat__value">3</span>
                                <span class="storage-stat__label">Videos</span>
                            </div>
                        </div>
                        <div class="storage-stat">
                            <div class="storage-stat__icon storage-stat__icon--storage">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/>
                                </svg>
                            </div>
                            <div class="storage-stat__info">
                                <span class="storage-stat__value">1.8 GB</span>
                                <span class="storage-stat__label">Used of 10 GB</span>
                            </div>
                            <div class="storage-stat__bar">
                                <div class="storage-stat__bar-fill" style="width: 18%;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="files-container">
                        <!-- Folder Tree -->
                        <div class="folder-tree" id="folderTree">
                            <div class="folder-tree__header">
                                <h3 class="folder-tree__title">Folders</h3>
                            </div>
                            <div class="folder-tree__list" id="folderList">
                                <!-- Folders will be rendered here -->
                            </div>
                        </div>
                        
                        <!-- File List -->
                        <div class="file-list-container">
                            <div class="file-list__header">
                                <div class="file-breadcrumb" id="fileBreadcrumb">
                                    <span class="breadcrumb-item active">All Files</span>
                                </div>
                                <div class="file-list__view-toggle">
                                    <button class="view-toggle-btn active" data-view="grid" onclick="toggleFileView('grid')">
                                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                                        </svg>
                                    </button>
                                    <button class="view-toggle-btn" data-view="list" onclick="toggleFileView('list')">
                                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="file-grid" id="fileGrid">
                                <!-- Files will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div> <!-- Close dashboard-page-wrapper -->
        </div> <!-- Close dashboardSection -->
            
            <!-- Messages Section -->
            <div id="messagesSection" class="content-section" style="display: none;">
                <div class="messages-page">
                    <div class="messages-header">
                        <div class="messages-header__left">
                            <h1 class="messages-page__title">Messages</h1>
                            <p class="messages-page__subtitle">Communicate with patients and staff</p>
                        </div>
                        <div class="messages-header__right">
                            <div class="messages-header__stats">
                                <div class="message-stat">
                                    <span class="message-stat__value" id="unreadCount">5</span>
                                    <span class="message-stat__label">Unread</span>
                                </div>
                                <div class="message-stat">
                                    <span class="message-stat__value" id="totalConversations">12</span>
                                    <span class="message-stat__label">Conversations</span>
                                </div>
                                <div class="message-stat">
                                    <span class="message-stat__value" id="onlineContacts">8</span>
                                    <span class="message-stat__label">Online</span>
                                </div>
                            </div>
                            <div class="messages-header__actions">
                                <button class="btn btn--secondary btn--sm" onclick="markAllRead()">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                    </svg>
                                    Mark All Read
                                </button>
                                <button class="btn btn--primary btn--sm" onclick="startNewConversation()">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    New Message
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="messages-layout">
                        <!-- Left Panel: Chatbox (66.66%) -->
                        <div class="chat-panel" id="chatPanel">
                            <!-- Chat Header -->
                            <div class="chat-header" id="chatHeader">
                                <div class="chat-header__placeholder">
                                    <svg width="48" height="48" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                                    </svg>
                                    <h3>No Conversation Selected</h3>
                                    <p>Select a conversation from the right panel to start messaging</p>
                                    <div class="chat-header__quick-actions">
                                        <button class="btn btn--secondary btn--sm" onclick="startNewConversation()">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                            </svg>
                                            New Message
                                        </button>
                                        <button class="btn btn--secondary btn--sm" onclick="viewBroadcasts()">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
                                            </svg>
                                            Broadcasts
                                        </button>
                                    </div>
                                </div>
                                <div class="chat-header__active" style="display: none;">
                                    <div class="chat-header__user">
                                        <div class="chat-avatar" id="chatAvatar">
                                            <span id="chatAvatarInitial">A</span>
                                        </div>
                                        <div class="chat-header__info">
                                            <div class="chat-header__name" id="chatName">Alice Tan</div>
                                            <div class="chat-header__status" id="chatStatus">Online</div>
                                        </div>
                                    </div>
                                    <div class="chat-header__actions">
                                        <button class="chat-action-btn" title="Video Call" aria-label="Start video call">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                                            </svg>
                                        </button>
                                        <button class="chat-action-btn" title="Voice Call" aria-label="Start voice call">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                            </svg>
                                        </button>
                                        <button class="chat-action-btn" title="More Options" aria-label="More options">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Messages Area -->
                            <div class="chat-messages" id="chatMessages" role="log" aria-live="polite" aria-atomic="false">
                                <!-- Messages will be inserted here -->
                            </div>
                            
                            <!-- Typing Indicator -->
                            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                                <div class="typing-indicator__content">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                                <span class="typing-indicator__text">typing...</span>
                            </div>
                            
                            <!-- Message Composer -->
                            <div class="chat-composer" id="chatComposer">
                                <button class="composer-btn" title="Attach File" aria-label="Attach file">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                                <button class="composer-btn" title="Emoji" aria-label="Insert emoji">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                                <textarea 
                                    class="composer-input" 
                                    id="messageInput" 
                                    placeholder="Type a message..." 
                                    rows="1"
                                    aria-label="Message input"
                                ></textarea>
                                <button class="composer-send" id="sendButton" aria-label="Send message">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Right Panel: Participants List (33.33%) -->
                        <div class="participants-panel" id="participantsPanel">
                            <!-- Search Box -->
                            <div class="participants-search">
                                <svg class="search-icon" width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                </svg>
                                <input 
                                    type="text" 
                                    class="search-input" 
                                    id="participantSearch" 
                                    placeholder="Search conversations..."
                                    aria-label="Search conversations"
                                />
                            </div>
                            
                            <!-- Filter Tabs -->
                            <div class="participants-filter">
                                <button class="filter-tab active" data-filter="all" onclick="filterParticipants('all')">
                                    All
                                </button>
                                <button class="filter-tab" data-filter="patient" onclick="filterParticipants('patient')">
                                    Patients
                                </button>
                                <button class="filter-tab" data-filter="physio" onclick="filterParticipants('physio')">
                                    Physiotherapists
                                </button>
                            </div>
                            
                            <!-- Participants List -->
                            <div class="participants-list" id="participantsList" role="list">
                                <!-- Participants will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- User Profile Section - New Professional Design -->
            <div id="profileSection" class="content-section" style="display: none;">
                <div class="profile-page-new">
                    <!-- Profile Header Banner -->
                    <div class="profile-banner">
                        <div class="profile-banner__content">
                            <div class="profile-banner__avatar">
                                <div class="avatar-circle" id="profilePageAvatar">
                                    <span id="profilePageInitial">D</span>
                                </div>
                                <div class="avatar-status avatar-status--online"></div>
                            </div>
                            <div class="profile-banner__info">
                                <h1 class="profile-banner__name" id="profilePageName">Dr. Dokter</h1>
                                <p class="profile-banner__role" id="profilePageRole">Senior Neurologist</p>
                                <div class="profile-banner__badges">
                                    <span class="badge badge--primary">
                                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        Verified
                                    </span>
                                    <span class="badge badge--secondary" id="profilePageSpecialization">Neurology</span>
                                </div>
                            </div>
                            <div class="profile-banner__actions">
                                <button class="btn btn--secondary btn--sm" onclick="editProfile()">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                    Edit Profile
                                </button>
                                <button class="btn btn--outline btn--sm" onclick="handleLogout()">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                    </svg>
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Stats Row -->
                    <div class="profile-stats-row">
                        <div class="profile-stat-card">
                            <div class="profile-stat-card__icon profile-stat-card__icon--primary">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <div class="profile-stat-card__content">
                                <span class="profile-stat-card__value" id="profilePagePatients">127</span>
                                <span class="profile-stat-card__label">Total Patients</span>
                            </div>
                        </div>
                        <div class="profile-stat-card">
                            <div class="profile-stat-card__icon profile-stat-card__icon--success">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <div class="profile-stat-card__content">
                                <span class="profile-stat-card__value" id="profilePageSessions">1,248</span>
                                <span class="profile-stat-card__label">Sessions Done</span>
                            </div>
                        </div>
                        <div class="profile-stat-card">
                            <div class="profile-stat-card__icon profile-stat-card__icon--warning">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <div class="profile-stat-card__content">
                                <span class="profile-stat-card__value" id="profilePageExperience">8+</span>
                                <span class="profile-stat-card__label">Years Experience</span>
                            </div>
                        </div>
                        <div class="profile-stat-card">
                            <div class="profile-stat-card__icon profile-stat-card__icon--info">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                                </svg>
                            </div>
                            <div class="profile-stat-card__content">
                                <span class="profile-stat-card__value" id="profilePageRating">4.9</span>
                                <span class="profile-stat-card__label">Avg. Rating</span>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Info Grid -->
                    <div class="profile-info-grid">
                        <!-- Personal Information -->
                        <div class="profile-info-card">
                            <div class="profile-info-card__header">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                <h3>Personal Information</h3>
                            </div>
                            <div class="profile-info-card__body">
                                <div class="info-item">
                                    <span class="info-item__label">Full Name</span>
                                    <span class="info-item__value" id="profilePageFullName">Dr. Dokter Wijaya</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">License ID</span>
                                    <span class="info-item__value" id="profilePageLicense">MD-123456</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">Username</span>
                                    <span class="info-item__value" id="profilePageUsername">@dokter</span>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="profile-info-card">
                            <div class="profile-info-card__header">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                                <h3>Contact Information</h3>
                            </div>
                            <div class="profile-info-card__body">
                                <div class="info-item">
                                    <span class="info-item__label">Email</span>
                                    <span class="info-item__value" id="profilePageEmail">dokter@neurotrack.com</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">Phone</span>
                                    <span class="info-item__value" id="profilePagePhone">+62 812-3456-7890</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">Mobile</span>
                                    <span class="info-item__value" id="profilePageMobile">+62 856-9876-5432</span>
                                </div>
                            </div>
                        </div>

                        <!-- Professional Details -->
                        <div class="profile-info-card">
                            <div class="profile-info-card__header">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                </svg>
                                <h3>Professional Details</h3>
                            </div>
                            <div class="profile-info-card__body">
                                <div class="info-item">
                                    <span class="info-item__label">Hospital</span>
                                    <span class="info-item__value" id="profilePageHospital">General Hospital</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">Department</span>
                                    <span class="info-item__value" id="profilePageDepartment">Neuroscience Center</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">Specialization</span>
                                    <span class="info-item__value">Neurology & Rehabilitation</span>
                                </div>
                            </div>
                        </div>

                        <!-- Location -->
                        <div class="profile-info-card">
                            <div class="profile-info-card__header">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <h3>Location</h3>
                            </div>
                            <div class="profile-info-card__body">
                                <div class="info-item">
                                    <span class="info-item__label">Address</span>
                                    <span class="info-item__value" id="profilePageAddress">123 Medical Plaza</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">City</span>
                                    <span class="info-item__value" id="profilePageCity">Jakarta, Indonesia</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">Timezone</span>
                                    <span class="info-item__value">GMT+7 (WIB)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Account Details -->
                        <div class="profile-info-card">
                            <div class="profile-info-card__header">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                                <h3>Account Details</h3>
                            </div>
                            <div class="profile-info-card__body">
                                <div class="info-item">
                                    <span class="info-item__label">Account Type</span>
                                    <span class="info-item__value">Professional - Doctor</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">Member Since</span>
                                    <span class="info-item__value" id="profilePageMemberSince">December 2025</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-item__label">Last Login</span>
                                    <span class="info-item__value" id="profilePageLastLogin">Just now</span>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="profile-info-card profile-info-card--actions">
                            <div class="profile-info-card__header">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                </svg>
                                <h3>Quick Actions</h3>
                            </div>
                            <div class="profile-info-card__body profile-quick-actions">
                                <button class="quick-action-btn" onclick="changePassword()">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                                    </svg>
                                    Change Password
                                </button>
                                <button class="quick-action-btn" onclick="updateNotifications()">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                                    </svg>
                                    Notifications
                                </button>
                                <button class="quick-action-btn" onclick="downloadData()">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    Export Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Schedule Section -->
            <div id="scheduleSection" class="content-section" style="display: none;">
                <div class="schedule-page-wrapper">
                    <!-- Schedule Sidebar -->
                    <aside class="sidebar sidebar--fixed schedule-sidebar-nav" id="scheduleSidebarNav">
                        <div class="sidebar__header">
                            <h3 class="sidebar__title">Navigation</h3>
                            <button class="sidebar__toggle" id="scheduleSidebarToggle" onclick="toggleScheduleSidebar()" aria-label="Toggle sidebar">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
                                </svg>
                            </button>
                        </div>
                        
                        <nav class="sidebar__nav">
                            <button class="sidebar__item active" data-schedule-view="calendar" onclick="switchScheduleView('calendar')">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                <span class="sidebar__item-text">Calendar View</span>
                            </button>
                            <button class="sidebar__item" data-schedule-view="upcoming" onclick="switchScheduleView('upcoming')">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span class="sidebar__item-text">Upcoming Events</span>
                            </button>
                            <button class="sidebar__item" data-schedule-view="meetings" onclick="switchScheduleView('meetings')">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                                <span class="sidebar__item-text">Video Meetings</span>
                            </button>
                            <button class="sidebar__item" data-schedule-view="consultations" onclick="switchScheduleView('consultations')">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                </svg>
                                <span class="sidebar__item-text">Consultations</span>
                            </button>
                        </nav>
                        
                        <div class="sidebar__footer">
                            <div class="sidebar__quick-stats">
                                <div class="quick-stat">
                                    <span class="quick-stat__value" id="scheduleMeetingsCount">0</span>
                                    <span class="quick-stat__label">Meetings</span>
                                </div>
                                <div class="quick-stat">
                                    <span class="quick-stat__value" id="scheduleEventsCount">0</span>
                                    <span class="quick-stat__label">Events</span>
                                </div>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Schedule Content -->
                    <div class="schedule-main-content">
                        <!-- Calendar View -->
                        <div id="scheduleCalendarView" class="schedule-view-content">
                            <div class="schedule-header">
                                <div class="schedule-header__row">
                                    <div class="schedule-header__left">
                                        <h1 class="schedule-header__title">Calendar</h1>
                                        <p class="schedule-header__subtitle">Manage your schedule and appointments</p>
                                    </div>
                                    <div class="schedule-header__actions">
                                        <button class="btn btn--secondary btn--sm" onclick="exportCalendar()">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                            </svg>
                                            Export
                                        </button>
                                        <button class="btn btn--primary btn--sm" onclick="addNewEvent()">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                            </svg>
                                            Add Event
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="schedule-calendar-layout">
                                <!-- Left: Mini Calendar & Filters -->
                                <div class="calendar-sidebar-left">
                                    <!-- Mini Calendar -->
                                    <div class="mini-calendar">
                                        <div class="mini-calendar__header">
                                            <button class="mini-nav" onclick="miniPrevMonth(); return false;" aria-label="Previous month">
                                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                                </svg>
                                            </button>
                                            <span class="mini-calendar__title" id="miniCalendarTitle">Dec 2025</span>
                                            <button class="mini-nav" onclick="miniNextMonth(); return false;" aria-label="Next month">
                                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                                </svg>
                                            </button>
                                        </div>
                                        <div class="mini-calendar__grid" id="miniCalendarGrid"></div>
                                    </div>
                                    
                                    <!-- Event Filters -->
                                    <div class="event-filters">
                                        <h3 class="event-filters__title">Filter Events</h3>
                                        <label class="filter-checkbox">
                                            <input type="checkbox" checked onchange="filterEvents('practice')">
                                            <span class="filter-color practice"></span>
                                            <span class="filter-label">Practice</span>
                                        </label>
                                        <label class="filter-checkbox">
                                            <input type="checkbox" checked onchange="filterEvents('meeting')">
                                            <span class="filter-color meeting"></span>
                                            <span class="filter-label">Meeting</span>
                                        </label>
                                        <label class="filter-checkbox">
                                            <input type="checkbox" checked onchange="filterEvents('consultation')">
                                            <span class="filter-color consultation"></span>
                                            <span class="filter-label">Consultation</span>
                                        </label>
                                        <label class="filter-checkbox">
                                            <input type="checkbox" checked onchange="filterEvents('research')">
                                            <span class="filter-color research"></span>
                                            <span class="filter-label">Research</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Main Calendar -->
                                <div class="calendar-main calendar-main--full">
                                    <div class="calendar-controls">
                                        <div class="calendar-controls__left">
                                            <h2 class="calendar-title" id="calendarTitle">December 2025</h2>
                                            <button class="btn-today" onclick="goToToday()">Today</button>
                                        </div>
                                        <div class="calendar-controls__right">
                                            <button class="btn-nav" onclick="previousMonth()" aria-label="Previous month">
                                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                                </svg>
                                            </button>
                                            <button class="btn-nav" onclick="nextMonth()" aria-label="Next month">
                                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                                </svg>
                                            </button>
                                            <select class="view-selector" onchange="changeView(this.value)">
                                                <option value="month">Month</option>
                                                <option value="week">Week</option>
                                                <option value="day">Day</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="calendar-grid">
                                        <div class="calendar-header">
                                            <div class="calendar-header__day">Mon</div>
                                            <div class="calendar-header__day">Tue</div>
                                            <div class="calendar-header__day">Wed</div>
                                            <div class="calendar-header__day">Thu</div>
                                            <div class="calendar-header__day">Fri</div>
                                            <div class="calendar-header__day">Sat</div>
                                            <div class="calendar-header__day">Sun</div>
                                        </div>
                                        <div class="calendar-body" id="calendarBody"></div>
                                    </div>
                                </div>
                                
                                <!-- Right: Today's Events & Quick Actions -->
                                <div class="calendar-sidebar-right">
                                    <!-- Today's Events -->
                                    <div class="todays-events">
                                        <div class="todays-events__header">
                                            <h3 class="todays-events__title">Today's Schedule</h3>
                                            <span class="todays-events__date" id="todaysDate">Dec 16</span>
                                        </div>
                                        <div class="todays-events__list" id="todaysEventsList">
                                            <!-- Events will be dynamically populated -->
                                        </div>
                                    </div>
                                    
                                    <!-- Quick Actions -->
                                    <div class="calendar-quick-actions">
                                        <h3 class="calendar-quick-actions__title">Quick Actions</h3>
                                        <div class="calendar-quick-actions__list">
                                            <button class="calendar-quick-action" onclick="addNewEvent()">
                                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                                </svg>
                                                <span>New Event</span>
                                            </button>
                                            <button class="calendar-quick-action" onclick="scheduleNewMeeting()">
                                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                                </svg>
                                                <span>Video Call</span>
                                            </button>
                                            <button class="calendar-quick-action" onclick="scheduleConsultation()">
                                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                                </svg>
                                                <span>Consultation</span>
                                            </button>
                                            <button class="calendar-quick-action" onclick="setReminder()">
                                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                                                </svg>
                                                <span>Reminder</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Meetings View -->
                        <div id="scheduleMeetingsView" class="schedule-view-content" style="display: none;">
                            <div class="schedule-header">
                                <div class="schedule-header__row">
                                    <div class="schedule-header__left">
                                        <h1 class="schedule-header__title">Video Meetings</h1>
                                        <p class="schedule-header__subtitle">Join or schedule video consultations</p>
                                    </div>
                                    <div class="schedule-header__actions">
                                        <button class="btn btn--secondary btn--sm" onclick="instantMeeting()">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                            </svg>
                                            Start Instant
                                        </button>
                                        <button class="btn btn--primary btn--sm" onclick="scheduleNewMeeting()">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                            </svg>
                                            Schedule New
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Meeting Quick Stats -->
                            <div class="meeting-quick-stats">
                                <div class="meeting-stat-card">
                                    <div class="meeting-stat-card__icon meeting-stat-card__icon--scheduled">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                    </div>
                                    <div class="meeting-stat-card__info">
                                        <span class="meeting-stat-card__value">3</span>
                                        <span class="meeting-stat-card__label">Scheduled Today</span>
                                    </div>
                                </div>
                                <div class="meeting-stat-card">
                                    <div class="meeting-stat-card__icon meeting-stat-card__icon--upcoming">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="meeting-stat-card__info">
                                        <span class="meeting-stat-card__value">8</span>
                                        <span class="meeting-stat-card__label">This Week</span>
                                    </div>
                                </div>
                                <div class="meeting-stat-card">
                                    <div class="meeting-stat-card__icon meeting-stat-card__icon--completed">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="meeting-stat-card__info">
                                        <span class="meeting-stat-card__value">24</span>
                                        <span class="meeting-stat-card__label">Completed</span>
                                    </div>
                                </div>
                                <div class="meeting-stat-card">
                                    <div class="meeting-stat-card__icon meeting-stat-card__icon--duration">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="meeting-stat-card__info">
                                        <span class="meeting-stat-card__value">32m</span>
                                        <span class="meeting-stat-card__label">Avg Duration</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="meetings-layout">
                                <!-- Meetings List -->
                                <div class="meetings-list-panel">
                                    <div class="meetings-list-header">
                                        <h3>Upcoming Meetings</h3>
                                        <div class="meetings-filter-tabs">
                                            <button class="filter-tab active" onclick="filterMeetings('all')">All</button>
                                            <button class="filter-tab" onclick="filterMeetings('today')">Today</button>
                                            <button class="filter-tab" onclick="filterMeetings('week')">Week</button>
                                        </div>
                                    </div>
                                    <div class="meetings-list" id="meetingsList" role="list"></div>
                                </div>
                                
                                <!-- Meeting Preview -->
                                <div class="meeting-preview-panel" id="meetingPreviewPane">
                                    <div class="meeting-preview-empty" id="meetingPreviewEmpty">
                                        <div class="meeting-preview-empty__icon">
                                            <svg width="64" height="64" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                                            </svg>
                                        </div>
                                        <h3 class="meeting-preview-empty__title">Select a Meeting</h3>
                                        <p class="meeting-preview-empty__desc">Choose a meeting from the list to preview and join</p>
                                        <div class="meeting-preview-empty__actions">
                                            <button class="btn btn--secondary btn--sm" onclick="instantMeeting()">Start Instant Meeting</button>
                                        </div>
                                    </div>
                                    
                                    <div class="meeting-preview-active" id="meetingPreviewActive" style="display: none;">
                                        <div class="meeting-video-preview">
                                            <div class="video-placeholder">
                                                <div class="video-placeholder__avatar">
                                                    <svg width="80" height="80" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                                    </svg>
                                                </div>
                                                <p class="video-placeholder__text">Camera Preview</p>
                                            </div>
                                        </div>
                                        
                                        <div class="meeting-controls">
                                            <button class="meeting-control-btn" id="meetingMicBtn" onclick="toggleMeetingMic()" aria-label="Toggle microphone">
                                                <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"/>
                                                </svg>
                                            </button>
                                            <button class="meeting-control-btn meeting-control-btn--primary" onclick="startMeeting()">
                                                <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                                                </svg>
                                                <span>Join</span>
                                            </button>
                                            <button class="meeting-control-btn" id="meetingCameraBtn" onclick="toggleMeetingCamera()" aria-label="Toggle camera">
                                                <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                                                </svg>
                                            </button>
                                        </div>
                                        
                                        <div class="meeting-info-bar">
                                            <h4 class="meeting-info-bar__title" id="previewMeetingTitle">Meeting Title</h4>
                                            <p class="meeting-info-bar__desc" id="previewMeetingDesc">Meeting description</p>
                                            <div class="meeting-info-bar__details">
                                                <span class="meeting-detail">
                                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                                    </svg>
                                                    <span id="previewMeetingTime">--</span>
                                                </span>
                                                <span class="meeting-detail">
                                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                                                    </svg>
                                                    <span id="previewMeetingParticipants">--</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Upcoming Events View -->
                        <div id="scheduleUpcomingView" class="schedule-view-content" style="display: none;">
                            <div class="schedule-header">
                                <div class="schedule-header__row">
                                    <div class="schedule-header__left">
                                        <h1 class="schedule-header__title">Upcoming Events</h1>
                                        <p class="schedule-header__subtitle">Your scheduled events for the coming days</p>
                                    </div>
                                    <div class="schedule-header__actions">
                                        <button class="btn btn--secondary btn--sm" onclick="filterUpcomingEvents('all')">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                                            </svg>
                                            All Events
                                        </button>
                                        <button class="btn btn--secondary btn--sm" onclick="filterUpcomingEvents('today')">Today</button>
                                        <button class="btn btn--secondary btn--sm" onclick="filterUpcomingEvents('week')">This Week</button>
                                        <button class="btn btn--primary btn--sm" onclick="addNewEvent()">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                            </svg>
                                            Add Event
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Stats for Events -->
                            <div class="events-quick-stats">
                                <div class="event-stat-card">
                                    <div class="event-stat-card__icon event-stat-card__icon--today">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                    </div>
                                    <div class="event-stat-card__info">
                                        <span class="event-stat-card__value" id="todayEventsCount">4</span>
                                        <span class="event-stat-card__label">Today</span>
                                    </div>
                                </div>
                                <div class="event-stat-card">
                                    <div class="event-stat-card__icon event-stat-card__icon--week">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="event-stat-card__info">
                                        <span class="event-stat-card__value" id="weekEventsCount">12</span>
                                        <span class="event-stat-card__label">This Week</span>
                                    </div>
                                </div>
                                <div class="event-stat-card">
                                    <div class="event-stat-card__icon event-stat-card__icon--meetings">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                        </svg>
                                    </div>
                                    <div class="event-stat-card__info">
                                        <span class="event-stat-card__value" id="meetingsCount">5</span>
                                        <span class="event-stat-card__label">Meetings</span>
                                    </div>
                                </div>
                                <div class="event-stat-card">
                                    <div class="event-stat-card__icon event-stat-card__icon--consults">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        </svg>
                                    </div>
                                    <div class="event-stat-card__info">
                                        <span class="event-stat-card__value" id="consultsCount">7</span>
                                        <span class="event-stat-card__label">Consultations</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="upcoming-events-full" id="upcomingEventsFullList"></div>
                        </div>
                        
                        <!-- Consultations View -->
                        <div id="scheduleConsultationsView" class="schedule-view-content" style="display: none;">
                            <div class="schedule-header">
                                <div class="schedule-header__row">
                                    <div class="schedule-header__left">
                                        <h1 class="schedule-header__title">Patient Consultations</h1>
                                        <p class="schedule-header__subtitle">Scheduled patient consultations</p>
                                    </div>
                                    <div class="schedule-header__actions">
                                        <button class="btn btn--secondary btn--sm" onclick="filterConsultations('all')">All</button>
                                        <button class="btn btn--secondary btn--sm" onclick="filterConsultations('pending')">Pending</button>
                                        <button class="btn btn--secondary btn--sm" onclick="filterConsultations('completed')">Completed</button>
                                        <button class="btn btn--primary btn--sm" onclick="scheduleConsultation()">
                                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                            </svg>
                                            Schedule New
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Consultation Stats -->
                            <div class="consultation-stats">
                                <div class="consultation-stat">
                                    <span class="consultation-stat__value" id="totalConsultations">15</span>
                                    <span class="consultation-stat__label">Total This Month</span>
                                </div>
                                <div class="consultation-stat">
                                    <span class="consultation-stat__value" id="pendingConsultations">8</span>
                                    <span class="consultation-stat__label">Pending</span>
                                </div>
                                <div class="consultation-stat">
                                    <span class="consultation-stat__value" id="completedConsultations">7</span>
                                    <span class="consultation-stat__label">Completed</span>
                                </div>
                                <div class="consultation-stat">
                                    <span class="consultation-stat__value" id="avgDuration">25m</span>
                                    <span class="consultation-stat__label">Avg Duration</span>
                                </div>
                            </div>
                            
                            <div class="consultations-list" id="consultationsList"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Dashboard JavaScript -->
    <script>
        // ==================== GLOBAL DATA ====================
        let patientsData = null;
        let filesData = null;
        let selectedPatient = null;
        let selectedPatientForList = null;
        let currentFolder = null;
        let fileViewMode = 'grid';
        let chartInstances = {};
        
        // Embedded fallback data for patients
        const fallbackPatientsData = {
            patients: [
                { id: "pat001", name: "Alice Tan", primaryDiagnosis: "Post-Stroke Recovery", admissionDate: "2025-10-15", physioAssigned: "Dr. Sarah Johnson", status: "active", recentNotes: "Patient showing good progress. Mobility improving steadily.", kpiSnapshot: { mobilityScore: 72, mobilityTrend: "up", adlIndependence: 65, adlTrend: "up", therapyAdherence: 92, adherenceTrend: "stable", painLevel: 3, painTrend: "down" } },
                { id: "pat002", name: "Robert Chen", primaryDiagnosis: "Motor Function Rehab", admissionDate: "2025-11-01", physioAssigned: "Dr. Michael Lee", status: "active", recentNotes: "Hand exercises improving grip strength.", kpiSnapshot: { mobilityScore: 58, mobilityTrend: "up", adlIndependence: 48, adlTrend: "stable", therapyAdherence: 88, adherenceTrend: "up", painLevel: 5, painTrend: "stable" } },
                { id: "pat003", name: "Maria Santos", primaryDiagnosis: "Balance Recovery", admissionDate: "2025-09-20", physioAssigned: "Dr. Emily Davis", status: "active", recentNotes: "Major milestone - 20 steps unassisted!", kpiSnapshot: { mobilityScore: 85, mobilityTrend: "up", adlIndependence: 78, adlTrend: "up", therapyAdherence: 95, adherenceTrend: "stable", painLevel: 2, painTrend: "down" } },
                { id: "pat004", name: "John Williams", primaryDiagnosis: "Speech Therapy", admissionDate: "2025-08-05", physioAssigned: "Dr. Sarah Johnson", status: "stable", recentNotes: "Pronunciation exercises showing improvement.", kpiSnapshot: { mobilityScore: 90, mobilityTrend: "stable", adlIndependence: 85, adlTrend: "stable", therapyAdherence: 82, adherenceTrend: "down", painLevel: 1, painTrend: "stable" } },
                { id: "pat005", name: "Susan Park", primaryDiagnosis: "Upper Limb Recovery", admissionDate: "2025-11-10", physioAssigned: "Dr. Michael Lee", status: "active", recentNotes: "Requesting more therapy sessions.", kpiSnapshot: { mobilityScore: 45, mobilityTrend: "up", adlIndependence: 40, adlTrend: "up", therapyAdherence: 98, adherenceTrend: "up", painLevel: 6, painTrend: "down" } },
                { id: "pat006", name: "David Kim", primaryDiagnosis: "Parkinson's Rehab", admissionDate: "2025-07-15", physioAssigned: "Dr. Sarah Johnson", status: "active", recentNotes: "Tremor management improving with exercises.", kpiSnapshot: { mobilityScore: 62, mobilityTrend: "up", adlIndependence: 58, adlTrend: "stable", therapyAdherence: 90, adherenceTrend: "stable", painLevel: 2, painTrend: "stable" } },
                { id: "pat007", name: "Emma Thompson", primaryDiagnosis: "Spinal Cord Injury", admissionDate: "2025-09-01", physioAssigned: "Dr. Michael Lee", status: "critical", recentNotes: "Making progress with assisted walking. Requires close monitoring.", kpiSnapshot: { mobilityScore: 25, mobilityTrend: "up", adlIndependence: 30, adlTrend: "up", therapyAdherence: 100, adherenceTrend: "stable", painLevel: 7, painTrend: "down" } },
                { id: "pat008", name: "James Rodriguez", primaryDiagnosis: "Traumatic Brain Injury", admissionDate: "2025-10-05", physioAssigned: "Dr. Emily Davis", status: "active", recentNotes: "Cognitive exercises combined with physical therapy showing results.", kpiSnapshot: { mobilityScore: 55, mobilityTrend: "up", adlIndependence: 50, adlTrend: "up", therapyAdherence: 85, adherenceTrend: "up", painLevel: 4, painTrend: "down" } },
                { id: "pat009", name: "Linda Chen", primaryDiagnosis: "Multiple Sclerosis", admissionDate: "2025-06-20", physioAssigned: "Dr. Sarah Johnson", status: "stable", recentNotes: "Maintaining current function levels. Focus on fatigue management.", kpiSnapshot: { mobilityScore: 68, mobilityTrend: "stable", adlIndependence: 72, adlTrend: "stable", therapyAdherence: 92, adherenceTrend: "stable", painLevel: 3, painTrend: "stable" } },
                { id: "pat010", name: "Michael Brown", primaryDiagnosis: "Hip Replacement Recovery", admissionDate: "2025-11-25", physioAssigned: "Dr. Michael Lee", status: "active", recentNotes: "Post-surgery rehabilitation on track. Walking with cane.", kpiSnapshot: { mobilityScore: 40, mobilityTrend: "up", adlIndependence: 45, adlTrend: "up", therapyAdherence: 95, adherenceTrend: "up", painLevel: 5, painTrend: "down" } }
            ],
            patientTimeSeries: {
                pat001: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 35 }, { date: "2025-10-27", score: 42 }, { date: "2025-11-03", score: 50 },
                        { date: "2025-11-10", score: 58 }, { date: "2025-11-17", score: 63 }, { date: "2025-11-24", score: 68 }, { date: "2025-12-01", score: 72 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 7 }, { date: "2025-10-27", level: 6 }, { date: "2025-11-03", level: 5 },
                        { date: "2025-11-10", level: 5 }, { date: "2025-11-17", level: 4 }, { date: "2025-11-24", level: 4 }, { date: "2025-12-01", level: 3 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 3, scheduled: 3 }, { date: "2025-10-27", completed: 2, scheduled: 3 },
                        { date: "2025-11-03", completed: 3, scheduled: 3 }, { date: "2025-11-10", completed: 3, scheduled: 3 },
                        { date: "2025-11-17", completed: 2, scheduled: 3 }, { date: "2025-11-24", completed: 3, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 5, missed: 0 }, { week: "Week 2", attended: 4, missed: 1 },
                        { week: "Week 3", attended: 5, missed: 0 }, { week: "Week 4", attended: 5, missed: 0 },
                        { week: "Week 5", attended: 4, missed: 1 }, { week: "Week 6", attended: 5, missed: 0 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 25, lowerLimb: 40, grip: 18 },
                        { date: "2025-10-27", upperLimb: 30, lowerLimb: 45, grip: 22 },
                        { date: "2025-11-03", upperLimb: 35, lowerLimb: 50, grip: 28 },
                        { date: "2025-11-10", upperLimb: 42, lowerLimb: 55, grip: 32 },
                        { date: "2025-11-17", upperLimb: 48, lowerLimb: 60, grip: 38 },
                        { date: "2025-11-24", upperLimb: 52, lowerLimb: 65, grip: 42 },
                        { date: "2025-12-01", upperLimb: 58, lowerLimb: 70, grip: 48 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.4 }, { date: "2025-10-27", speed: 0.5 },
                        { date: "2025-11-03", speed: 0.6 }, { date: "2025-11-10", speed: 0.7 },
                        { date: "2025-11-17", speed: 0.75 }, { date: "2025-11-24", speed: 0.82 }, { date: "2025-12-01", speed: 0.88 }
                    ]
                },
                pat002: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 30 }, { date: "2025-10-27", score: 35 }, { date: "2025-11-03", score: 40 },
                        { date: "2025-11-10", score: 45 }, { date: "2025-11-17", score: 50 }, { date: "2025-11-24", score: 54 }, { date: "2025-12-01", score: 58 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 6 }, { date: "2025-10-27", level: 6 }, { date: "2025-11-03", level: 5 },
                        { date: "2025-11-10", level: 5 }, { date: "2025-11-17", level: 5 }, { date: "2025-11-24", level: 5 }, { date: "2025-12-01", level: 5 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 2, scheduled: 3 }, { date: "2025-10-27", completed: 3, scheduled: 3 },
                        { date: "2025-11-03", completed: 3, scheduled: 3 }, { date: "2025-11-10", completed: 2, scheduled: 3 },
                        { date: "2025-11-17", completed: 3, scheduled: 3 }, { date: "2025-11-24", completed: 3, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 4, missed: 1 }, { week: "Week 2", attended: 5, missed: 0 },
                        { week: "Week 3", attended: 5, missed: 0 }, { week: "Week 4", attended: 4, missed: 1 },
                        { week: "Week 5", attended: 5, missed: 0 }, { week: "Week 6", attended: 5, missed: 0 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 20, lowerLimb: 35, grip: 15 },
                        { date: "2025-10-27", upperLimb: 24, lowerLimb: 38, grip: 18 },
                        { date: "2025-11-03", upperLimb: 28, lowerLimb: 42, grip: 22 },
                        { date: "2025-11-10", upperLimb: 32, lowerLimb: 46, grip: 26 },
                        { date: "2025-11-17", upperLimb: 36, lowerLimb: 50, grip: 30 },
                        { date: "2025-11-24", upperLimb: 40, lowerLimb: 54, grip: 34 },
                        { date: "2025-12-01", upperLimb: 45, lowerLimb: 58, grip: 38 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.35 }, { date: "2025-10-27", speed: 0.4 },
                        { date: "2025-11-03", speed: 0.45 }, { date: "2025-11-10", speed: 0.5 },
                        { date: "2025-11-17", speed: 0.55 }, { date: "2025-11-24", speed: 0.6 }, { date: "2025-12-01", speed: 0.65 }
                    ]
                },
                pat003: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 55 }, { date: "2025-10-27", score: 60 }, { date: "2025-11-03", score: 66 },
                        { date: "2025-11-10", score: 72 }, { date: "2025-11-17", score: 76 }, { date: "2025-11-24", score: 80 }, { date: "2025-12-01", score: 85 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 4 }, { date: "2025-10-27", level: 4 }, { date: "2025-11-03", level: 3 },
                        { date: "2025-11-10", level: 3 }, { date: "2025-11-17", level: 3 }, { date: "2025-11-24", level: 2 }, { date: "2025-12-01", level: 2 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 3, scheduled: 3 }, { date: "2025-10-27", completed: 3, scheduled: 3 },
                        { date: "2025-11-03", completed: 3, scheduled: 3 }, { date: "2025-11-10", completed: 3, scheduled: 3 },
                        { date: "2025-11-17", completed: 3, scheduled: 3 }, { date: "2025-11-24", completed: 2, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 5, missed: 0 }, { week: "Week 2", attended: 5, missed: 0 },
                        { week: "Week 3", attended: 5, missed: 0 }, { week: "Week 4", attended: 5, missed: 0 },
                        { week: "Week 5", attended: 4, missed: 1 }, { week: "Week 6", attended: 5, missed: 0 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 45, lowerLimb: 55, grip: 40 },
                        { date: "2025-10-27", upperLimb: 50, lowerLimb: 60, grip: 45 },
                        { date: "2025-11-03", upperLimb: 55, lowerLimb: 65, grip: 50 },
                        { date: "2025-11-10", upperLimb: 60, lowerLimb: 70, grip: 55 },
                        { date: "2025-11-17", upperLimb: 64, lowerLimb: 74, grip: 58 },
                        { date: "2025-11-24", upperLimb: 68, lowerLimb: 78, grip: 62 },
                        { date: "2025-12-01", upperLimb: 72, lowerLimb: 82, grip: 66 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.7 }, { date: "2025-10-27", speed: 0.75 },
                        { date: "2025-11-03", speed: 0.8 }, { date: "2025-11-10", speed: 0.85 },
                        { date: "2025-11-17", speed: 0.9 }, { date: "2025-11-24", speed: 0.95 }, { date: "2025-12-01", speed: 1.0 }
                    ]
                },
                pat004: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 80 }, { date: "2025-10-27", score: 82 }, { date: "2025-11-03", score: 84 },
                        { date: "2025-11-10", score: 86 }, { date: "2025-11-17", score: 87 }, { date: "2025-11-24", score: 88 }, { date: "2025-12-01", score: 90 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 2 }, { date: "2025-10-27", level: 2 }, { date: "2025-11-03", level: 1 },
                        { date: "2025-11-10", level: 1 }, { date: "2025-11-17", level: 1 }, { date: "2025-11-24", level: 1 }, { date: "2025-12-01", level: 1 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 3, scheduled: 3 }, { date: "2025-10-27", completed: 2, scheduled: 3 },
                        { date: "2025-11-03", completed: 3, scheduled: 3 }, { date: "2025-11-10", completed: 2, scheduled: 3 },
                        { date: "2025-11-17", completed: 3, scheduled: 3 }, { date: "2025-11-24", completed: 2, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 5, missed: 0 }, { week: "Week 2", attended: 4, missed: 1 },
                        { week: "Week 3", attended: 5, missed: 0 }, { week: "Week 4", attended: 4, missed: 1 },
                        { week: "Week 5", attended: 5, missed: 0 }, { week: "Week 6", attended: 4, missed: 1 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 65, lowerLimb: 75, grip: 60 },
                        { date: "2025-10-27", upperLimb: 67, lowerLimb: 77, grip: 62 },
                        { date: "2025-11-03", upperLimb: 70, lowerLimb: 80, grip: 65 },
                        { date: "2025-11-10", upperLimb: 72, lowerLimb: 82, grip: 67 },
                        { date: "2025-11-17", upperLimb: 74, lowerLimb: 84, grip: 70 },
                        { date: "2025-11-24", upperLimb: 76, lowerLimb: 86, grip: 72 },
                        { date: "2025-12-01", upperLimb: 78, lowerLimb: 88, grip: 75 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.9 }, { date: "2025-10-27", speed: 0.92 },
                        { date: "2025-11-03", speed: 0.95 }, { date: "2025-11-10", speed: 0.97 },
                        { date: "2025-11-17", speed: 1.0 }, { date: "2025-11-24", speed: 1.02 }, { date: "2025-12-01", speed: 1.05 }
                    ]
                },
                pat005: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 20 }, { date: "2025-10-27", score: 25 }, { date: "2025-11-03", score: 30 },
                        { date: "2025-11-10", score: 35 }, { date: "2025-11-17", score: 38 }, { date: "2025-11-24", score: 42 }, { date: "2025-12-01", score: 45 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 8 }, { date: "2025-10-27", level: 7 }, { date: "2025-11-03", level: 7 },
                        { date: "2025-11-10", level: 6 }, { date: "2025-11-17", level: 6 }, { date: "2025-11-24", level: 6 }, { date: "2025-12-01", level: 6 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 3, scheduled: 3 }, { date: "2025-10-27", completed: 3, scheduled: 3 },
                        { date: "2025-11-03", completed: 3, scheduled: 3 }, { date: "2025-11-10", completed: 3, scheduled: 3 },
                        { date: "2025-11-17", completed: 3, scheduled: 3 }, { date: "2025-11-24", completed: 3, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 5, missed: 0 }, { week: "Week 2", attended: 5, missed: 0 },
                        { week: "Week 3", attended: 5, missed: 0 }, { week: "Week 4", attended: 5, missed: 0 },
                        { week: "Week 5", attended: 5, missed: 0 }, { week: "Week 6", attended: 5, missed: 0 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 15, lowerLimb: 30, grip: 10 },
                        { date: "2025-10-27", upperLimb: 18, lowerLimb: 33, grip: 13 },
                        { date: "2025-11-03", upperLimb: 22, lowerLimb: 36, grip: 16 },
                        { date: "2025-11-10", upperLimb: 26, lowerLimb: 40, grip: 20 },
                        { date: "2025-11-17", upperLimb: 30, lowerLimb: 44, grip: 24 },
                        { date: "2025-11-24", upperLimb: 34, lowerLimb: 48, grip: 28 },
                        { date: "2025-12-01", upperLimb: 38, lowerLimb: 52, grip: 32 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.25 }, { date: "2025-10-27", speed: 0.3 },
                        { date: "2025-11-03", speed: 0.35 }, { date: "2025-11-10", speed: 0.4 },
                        { date: "2025-11-17", speed: 0.42 }, { date: "2025-11-24", speed: 0.45 }, { date: "2025-12-01", speed: 0.48 }
                    ]
                },
                pat006: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 48 }, { date: "2025-10-27", score: 52 }, { date: "2025-11-03", score: 55 },
                        { date: "2025-11-10", score: 57 }, { date: "2025-11-17", score: 59 }, { date: "2025-11-24", score: 61 }, { date: "2025-12-01", score: 62 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 3 }, { date: "2025-10-27", level: 3 }, { date: "2025-11-03", level: 2 },
                        { date: "2025-11-10", level: 2 }, { date: "2025-11-17", level: 2 }, { date: "2025-11-24", level: 2 }, { date: "2025-12-01", level: 2 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 3, scheduled: 3 }, { date: "2025-10-27", completed: 3, scheduled: 3 },
                        { date: "2025-11-03", completed: 2, scheduled: 3 }, { date: "2025-11-10", completed: 3, scheduled: 3 },
                        { date: "2025-11-17", completed: 3, scheduled: 3 }, { date: "2025-11-24", completed: 3, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 5, missed: 0 }, { week: "Week 2", attended: 5, missed: 0 },
                        { week: "Week 3", attended: 4, missed: 1 }, { week: "Week 4", attended: 5, missed: 0 },
                        { week: "Week 5", attended: 5, missed: 0 }, { week: "Week 6", attended: 5, missed: 0 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 40, lowerLimb: 48, grip: 35 },
                        { date: "2025-10-27", upperLimb: 42, lowerLimb: 50, grip: 37 },
                        { date: "2025-11-03", upperLimb: 44, lowerLimb: 52, grip: 39 },
                        { date: "2025-11-10", upperLimb: 46, lowerLimb: 54, grip: 41 },
                        { date: "2025-11-17", upperLimb: 48, lowerLimb: 56, grip: 43 },
                        { date: "2025-11-24", upperLimb: 50, lowerLimb: 58, grip: 45 },
                        { date: "2025-12-01", upperLimb: 52, lowerLimb: 60, grip: 47 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.55 }, { date: "2025-10-27", speed: 0.58 },
                        { date: "2025-11-03", speed: 0.6 }, { date: "2025-11-10", speed: 0.62 },
                        { date: "2025-11-17", speed: 0.64 }, { date: "2025-11-24", speed: 0.66 }, { date: "2025-12-01", speed: 0.68 }
                    ]
                },
                pat007: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 12 }, { date: "2025-10-27", score: 15 }, { date: "2025-11-03", score: 18 },
                        { date: "2025-11-10", score: 20 }, { date: "2025-11-17", score: 22 }, { date: "2025-11-24", score: 24 }, { date: "2025-12-01", score: 25 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 8 }, { date: "2025-10-27", level: 8 }, { date: "2025-11-03", level: 7 },
                        { date: "2025-11-10", level: 7 }, { date: "2025-11-17", level: 7 }, { date: "2025-11-24", level: 7 }, { date: "2025-12-01", level: 7 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 3, scheduled: 3 }, { date: "2025-10-27", completed: 3, scheduled: 3 },
                        { date: "2025-11-03", completed: 3, scheduled: 3 }, { date: "2025-11-10", completed: 3, scheduled: 3 },
                        { date: "2025-11-17", completed: 3, scheduled: 3 }, { date: "2025-11-24", completed: 3, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 5, missed: 0 }, { week: "Week 2", attended: 5, missed: 0 },
                        { week: "Week 3", attended: 5, missed: 0 }, { week: "Week 4", attended: 5, missed: 0 },
                        { week: "Week 5", attended: 5, missed: 0 }, { week: "Week 6", attended: 5, missed: 0 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 10, lowerLimb: 15, grip: 8 },
                        { date: "2025-10-27", upperLimb: 12, lowerLimb: 18, grip: 10 },
                        { date: "2025-11-03", upperLimb: 15, lowerLimb: 22, grip: 12 },
                        { date: "2025-11-10", upperLimb: 18, lowerLimb: 25, grip: 15 },
                        { date: "2025-11-17", upperLimb: 20, lowerLimb: 28, grip: 17 },
                        { date: "2025-11-24", upperLimb: 22, lowerLimb: 30, grip: 19 },
                        { date: "2025-12-01", upperLimb: 25, lowerLimb: 32, grip: 21 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.15 }, { date: "2025-10-27", speed: 0.18 },
                        { date: "2025-11-03", speed: 0.2 }, { date: "2025-11-10", speed: 0.22 },
                        { date: "2025-11-17", speed: 0.24 }, { date: "2025-11-24", speed: 0.26 }, { date: "2025-12-01", speed: 0.28 }
                    ]
                },
                pat008: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 38 }, { date: "2025-10-27", score: 42 }, { date: "2025-11-03", score: 46 },
                        { date: "2025-11-10", score: 48 }, { date: "2025-11-17", score: 51 }, { date: "2025-11-24", score: 53 }, { date: "2025-12-01", score: 55 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 6 }, { date: "2025-10-27", level: 5 }, { date: "2025-11-03", level: 5 },
                        { date: "2025-11-10", level: 4 }, { date: "2025-11-17", level: 4 }, { date: "2025-11-24", level: 4 }, { date: "2025-12-01", level: 4 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 2, scheduled: 3 }, { date: "2025-10-27", completed: 3, scheduled: 3 },
                        { date: "2025-11-03", completed: 3, scheduled: 3 }, { date: "2025-11-10", completed: 2, scheduled: 3 },
                        { date: "2025-11-17", completed: 3, scheduled: 3 }, { date: "2025-11-24", completed: 3, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 4, missed: 1 }, { week: "Week 2", attended: 5, missed: 0 },
                        { week: "Week 3", attended: 5, missed: 0 }, { week: "Week 4", attended: 4, missed: 1 },
                        { week: "Week 5", attended: 5, missed: 0 }, { week: "Week 6", attended: 5, missed: 0 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 30, lowerLimb: 38, grip: 25 },
                        { date: "2025-10-27", upperLimb: 33, lowerLimb: 41, grip: 28 },
                        { date: "2025-11-03", upperLimb: 36, lowerLimb: 44, grip: 31 },
                        { date: "2025-11-10", upperLimb: 39, lowerLimb: 47, grip: 34 },
                        { date: "2025-11-17", upperLimb: 42, lowerLimb: 50, grip: 37 },
                        { date: "2025-11-24", upperLimb: 45, lowerLimb: 53, grip: 40 },
                        { date: "2025-12-01", upperLimb: 48, lowerLimb: 56, grip: 43 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.45 }, { date: "2025-10-27", speed: 0.48 },
                        { date: "2025-11-03", speed: 0.52 }, { date: "2025-11-10", speed: 0.55 },
                        { date: "2025-11-17", speed: 0.58 }, { date: "2025-11-24", speed: 0.6 }, { date: "2025-12-01", speed: 0.62 }
                    ]
                },
                pat009: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 65 }, { date: "2025-10-27", score: 66 }, { date: "2025-11-03", score: 67 },
                        { date: "2025-11-10", score: 67 }, { date: "2025-11-17", score: 68 }, { date: "2025-11-24", score: 68 }, { date: "2025-12-01", score: 68 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 3 }, { date: "2025-10-27", level: 3 }, { date: "2025-11-03", level: 3 },
                        { date: "2025-11-10", level: 3 }, { date: "2025-11-17", level: 3 }, { date: "2025-11-24", level: 3 }, { date: "2025-12-01", level: 3 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 3, scheduled: 3 }, { date: "2025-10-27", completed: 3, scheduled: 3 },
                        { date: "2025-11-03", completed: 2, scheduled: 3 }, { date: "2025-11-10", completed: 3, scheduled: 3 },
                        { date: "2025-11-17", completed: 3, scheduled: 3 }, { date: "2025-11-24", completed: 3, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 5, missed: 0 }, { week: "Week 2", attended: 5, missed: 0 },
                        { week: "Week 3", attended: 4, missed: 1 }, { week: "Week 4", attended: 5, missed: 0 },
                        { week: "Week 5", attended: 5, missed: 0 }, { week: "Week 6", attended: 5, missed: 0 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 55, lowerLimb: 60, grip: 50 },
                        { date: "2025-10-27", upperLimb: 56, lowerLimb: 61, grip: 51 },
                        { date: "2025-11-03", upperLimb: 57, lowerLimb: 62, grip: 52 },
                        { date: "2025-11-10", upperLimb: 58, lowerLimb: 63, grip: 53 },
                        { date: "2025-11-17", upperLimb: 59, lowerLimb: 64, grip: 54 },
                        { date: "2025-11-24", upperLimb: 60, lowerLimb: 65, grip: 55 },
                        { date: "2025-12-01", upperLimb: 60, lowerLimb: 65, grip: 55 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.7 }, { date: "2025-10-27", speed: 0.71 },
                        { date: "2025-11-03", speed: 0.72 }, { date: "2025-11-10", speed: 0.72 },
                        { date: "2025-11-17", speed: 0.73 }, { date: "2025-11-24", speed: 0.73 }, { date: "2025-12-01", speed: 0.74 }
                    ]
                },
                pat010: {
                    mobilityProgress: [
                        { date: "2025-10-20", score: 22 }, { date: "2025-10-27", score: 28 }, { date: "2025-11-03", score: 32 },
                        { date: "2025-11-10", score: 35 }, { date: "2025-11-17", score: 37 }, { date: "2025-11-24", score: 39 }, { date: "2025-12-01", score: 40 }
                    ],
                    painTrend: [
                        { date: "2025-10-20", level: 7 }, { date: "2025-10-27", level: 6 }, { date: "2025-11-03", level: 6 },
                        { date: "2025-11-10", level: 5 }, { date: "2025-11-17", level: 5 }, { date: "2025-11-24", level: 5 }, { date: "2025-12-01", level: 5 }
                    ],
                    therapySessions: [
                        { date: "2025-10-20", completed: 3, scheduled: 3 }, { date: "2025-10-27", completed: 3, scheduled: 3 },
                        { date: "2025-11-03", completed: 3, scheduled: 3 }, { date: "2025-11-10", completed: 3, scheduled: 3 },
                        { date: "2025-11-17", completed: 2, scheduled: 3 }, { date: "2025-11-24", completed: 3, scheduled: 3 }, { date: "2025-12-01", completed: 3, scheduled: 3 }
                    ],
                    therapyAttendance: [
                        { week: "Week 1", attended: 5, missed: 0 }, { week: "Week 2", attended: 5, missed: 0 },
                        { week: "Week 3", attended: 5, missed: 0 }, { week: "Week 4", attended: 5, missed: 0 },
                        { week: "Week 5", attended: 4, missed: 1 }, { week: "Week 6", attended: 5, missed: 0 }
                    ],
                    strengthMetrics: [
                        { date: "2025-10-20", upperLimb: 18, lowerLimb: 25, grip: 15 },
                        { date: "2025-10-27", upperLimb: 22, lowerLimb: 30, grip: 18 },
                        { date: "2025-11-03", upperLimb: 26, lowerLimb: 35, grip: 22 },
                        { date: "2025-11-10", upperLimb: 30, lowerLimb: 40, grip: 26 },
                        { date: "2025-11-17", upperLimb: 34, lowerLimb: 45, grip: 30 },
                        { date: "2025-11-24", upperLimb: 38, lowerLimb: 50, grip: 34 },
                        { date: "2025-12-01", upperLimb: 42, lowerLimb: 55, grip: 38 }
                    ],
                    gaitSpeed: [
                        { date: "2025-10-20", speed: 0.2 }, { date: "2025-10-27", speed: 0.28 },
                        { date: "2025-11-03", speed: 0.35 }, { date: "2025-11-10", speed: 0.4 },
                        { date: "2025-11-17", speed: 0.44 }, { date: "2025-11-24", speed: 0.48 }, { date: "2025-12-01", speed: 0.52 }
                    ]
                }
            }
        };
        
        // Embedded fallback data for files
        const fallbackFilesData = {
            folders: [
                { id: "fld001", name: "Patient Records", icon: "", fileCount: 24 },
                { id: "fld002", name: "MRI Scans", icon: "", fileCount: 16 },
                { id: "fld003", name: "Lab Reports", icon: "", fileCount: 22 },
                { id: "fld004", name: "Progress Reports", icon: "", fileCount: 18 },
                { id: "fld005", name: "X-Ray Images", icon: "", fileCount: 12 },
                { id: "fld006", name: "Therapy Videos", icon: "", fileCount: 8 }
            ],
            files: [
                // Patient Records (fld001)
                { id: "file001", name: "Alice_Tan_Assessment.pdf", type: "pdf", size: "2.3 MB", date: "2025-12-10", folderId: "fld001" },
                { id: "file005", name: "John_Williams_Speech.pdf", type: "pdf", size: "3.1 MB", date: "2025-12-01", folderId: "fld001" },
                { id: "file006", name: "David_Kim_Initial.pdf", type: "pdf", size: "1.8 MB", date: "2025-12-09", folderId: "fld001" },
                { id: "file007", name: "Emma_Thompson_Spinal.pdf", type: "pdf", size: "2.5 MB", date: "2025-12-07", folderId: "fld001" },
                { id: "file008", name: "James_Rodriguez_TBI.pdf", type: "pdf", size: "3.2 MB", date: "2025-12-06", folderId: "fld001" },
                { id: "file009", name: "Linda_Chen_MS.pdf", type: "pdf", size: "2.1 MB", date: "2025-12-04", folderId: "fld001" },
                { id: "file010", name: "Michael_Brown_Hip.pdf", type: "pdf", size: "1.9 MB", date: "2025-12-03", folderId: "fld001" },
                // MRI Scans (fld002)
                { id: "file002", name: "Robert_Chen_MRI.dcm", type: "image", size: "45 MB", date: "2025-12-08", folderId: "fld002" },
                { id: "file011", name: "Susan_Park_Brain_MRI.dcm", type: "image", size: "52 MB", date: "2025-12-05", folderId: "fld002" },
                { id: "file012", name: "James_Rodriguez_MRI.dcm", type: "image", size: "48 MB", date: "2025-12-04", folderId: "fld002" },
                { id: "file013", name: "Linda_Chen_Spine_MRI.dcm", type: "image", size: "56 MB", date: "2025-12-02", folderId: "fld002" },
                // Lab Reports (fld003)
                { id: "file003", name: "Maria_Santos_Lab.pdf", type: "pdf", size: "1.2 MB", date: "2025-12-05", folderId: "fld003" },
                { id: "file014", name: "Alice_Tan_Blood_Work.pdf", type: "pdf", size: "890 KB", date: "2025-12-11", folderId: "fld003" },
                { id: "file015", name: "David_Kim_Dopamine.pdf", type: "pdf", size: "1.1 MB", date: "2025-12-08", folderId: "fld003" },
                { id: "file016", name: "Michael_Brown_PostOp.pdf", type: "pdf", size: "950 KB", date: "2025-12-06", folderId: "fld003" },
                // Progress Reports (fld004)
                { id: "file004", name: "Weekly_Progress_Dec.xlsx", type: "spreadsheet", size: "850 KB", date: "2025-12-12", folderId: "fld004" },
                { id: "file017", name: "Monthly_Summary_Nov.xlsx", type: "spreadsheet", size: "1.2 MB", date: "2025-11-30", folderId: "fld004" },
                { id: "file018", name: "Emma_Thompson_Progress.pdf", type: "pdf", size: "2.4 MB", date: "2025-12-09", folderId: "fld004" },
                { id: "file019", name: "Quarterly_Report_Q4.pdf", type: "pdf", size: "3.5 MB", date: "2025-12-01", folderId: "fld004" },
                // X-Ray Images (fld005)
                { id: "file020", name: "Michael_Brown_Hip_XRay.dcm", type: "image", size: "12 MB", date: "2025-12-10", folderId: "fld005" },
                { id: "file021", name: "John_Williams_Spine_XRay.dcm", type: "image", size: "8.5 MB", date: "2025-12-03", folderId: "fld005" },
                { id: "file022", name: "Robert_Chen_Chest_XRay.dcm", type: "image", size: "9.2 MB", date: "2025-12-01", folderId: "fld005" },
                // Therapy Videos (fld006)
                { id: "file023", name: "Alice_Tan_Session_12.mp4", type: "video", size: "125 MB", date: "2025-12-11", folderId: "fld006" },
                { id: "file024", name: "Emma_Thompson_Mobility.mp4", type: "video", size: "98 MB", date: "2025-12-08", folderId: "fld006" },
                { id: "file025", name: "David_Kim_Balance_Ex.mp4", type: "video", size: "87 MB", date: "2025-12-05", folderId: "fld006" }
            ]
        };
        
        // Doctor-specific notifications (loaded from JSON in production)
        const doctorNotifications = [
            { icon: 'warning', title: 'Critical Patient Alert', description: 'Patient John Doe (ID: 12345) requires immediate attention. Vitals show concerning trend', time: '2 min ago', unread: true },
            { icon: 'info', title: 'New Patient Assignment', description: 'You have been assigned a new patient: Sarah Williams. Review case file in your dashboard', time: '15 min ago', unread: true },
            { icon: 'success', title: 'Lab Results Ready', description: 'Laboratory results for patient Michael Brown are now available for review', time: '45 min ago', unread: true },
            { icon: 'info', title: 'Meeting Reminder', description: 'Multidisciplinary team meeting scheduled for today at 2:00 PM in Conference Room B', time: '1 hour ago', unread: true },
            { icon: 'warning', title: 'Prescription Renewal', description: 'Prescription for patient Emma Davis expires in 3 days. Please review and renew if necessary', time: '2 hours ago', unread: true },
            { icon: 'success', title: 'Patient Progress Report', description: 'Patient David Thompson has shown 40% improvement in mobility assessments this month', time: '4 hours ago', unread: true },
            { icon: 'info', title: 'Consultation Request', description: 'Dr. Anderson requests your consultation on a complex neurology case for patient review', time: 'Yesterday', unread: false },
            { icon: 'info', title: 'New Research Study', description: 'New clinical trial on post-stroke rehabilitation methods now accepting patient enrollment', time: 'Yesterday', unread: false },
            { icon: 'success', title: 'Patient Discharge Approval', description: 'Patient Lisa Martinez has been approved for discharge. Discharge summary completed', time: '2 days ago', unread: false },
            { icon: 'info', title: 'System Update', description: 'Electronic Health Records system will undergo scheduled maintenance this weekend', time: '3 days ago', unread: false }
        ];
        
        // Calendar events data (loaded from JSON in production)
        const calendarEvents = [
            { id: 'evt_001', title: 'Morning Rounds', description: 'Daily patient rounds - Ward 3A', category: 'practice', date: '2025-12-13', time: '08:00', icon: '' },
            { id: 'evt_002', title: 'Patient Consultation', description: 'Follow-up consultation with John Doe', category: 'consultation', date: '2025-12-13', time: '10:30', icon: '' },
            { id: 'evt_003', title: 'Team Meeting', description: 'Multidisciplinary team meeting', category: 'meeting', date: '2025-12-13', time: '14:00', icon: '', participants: ['Dr. Sarah Johnson', 'Dr. Michael Lee'] },
            { id: 'evt_004', title: 'Research Review', description: 'Clinical trial data analysis', category: 'research', date: '2025-12-13', time: '16:00', icon: '' },
            { id: 'evt_005', title: 'Emergency Consultation', description: 'Urgent patient consultation', category: 'consultation', date: '2025-12-14', time: '09:00', icon: '' },
            { id: 'evt_006', title: 'Department Meeting', description: 'Neurology department monthly meeting', category: 'meeting', date: '2025-12-14', time: '11:00', icon: '', participants: ['Full Department'] },
            { id: 'evt_007', title: 'Clinical Practice', description: 'Outpatient clinic', category: 'practice', date: '2025-12-14', time: '13:00', icon: '' },
            { id: 'evt_008', title: 'Lab Results Review', description: 'Review laboratory results', category: 'consultation', date: '2025-12-15', time: '10:00', icon: '' },
            { id: 'evt_009', title: 'Research Presentation', description: 'Present findings on rehabilitation', category: 'research', date: '2025-12-15', time: '14:00', icon: '' },
            { id: 'evt_010', title: 'Patient Follow-up', description: 'Follow-up with David Thompson', category: 'consultation', date: '2025-12-16', time: '09:30', icon: '' },
            { id: 'evt_011', title: 'Staff Meeting', description: 'Weekly staff coordination', category: 'meeting', date: '2025-12-16', time: '15:00', icon: '', participants: ['All Staff'] },
            { id: 'evt_012', title: 'Morning Practice', description: 'New patient consultations', category: 'practice', date: '2025-12-17', time: '08:00', icon: '' },
            { id: 'evt_013', title: 'Research Workshop', description: 'Latest neurological research', category: 'research', date: '2025-12-17', time: '13:00', icon: '' },
            { id: 'evt_014', title: 'Case Consultation', description: 'Complex case discussion', category: 'consultation', date: '2025-12-18', time: '10:00', icon: '' },
            { id: 'evt_015', title: 'Board Meeting', description: 'Hospital board meeting', category: 'meeting', date: '2025-12-18', time: '14:00', icon: '', participants: ['Board Members'] },
            { id: 'evt_016', title: 'Afternoon Clinic', description: 'Outpatient consultations', category: 'practice', date: '2025-12-19', time: '13:00', icon: '' },
            { id: 'evt_017', title: 'Patient Consultation', description: 'Initial consultation with Emma Davis', category: 'consultation', date: '2025-12-20', time: '09:00', icon: '' },
            { id: 'evt_018', title: 'Research Meeting', description: 'Clinical trial progress meeting', category: 'research', date: '2025-12-20', time: '11:00', icon: '' },
            { id: 'evt_019', title: 'Department Rounds', description: 'Weekly department rounds', category: 'practice', date: '2025-12-23', time: '08:00', icon: '' },
            { id: 'evt_020', title: 'Year-End Review', description: 'Annual performance meeting', category: 'meeting', date: '2025-12-27', time: '10:00', icon: '', participants: ['Management Team'] }
        ];

        // Calendar state - single shared date for both calendars
        let currentDate = new Date(2025, 11, 13); // December 13, 2025
        let activeFilters = ['practice', 'meeting', 'consultation', 'research'];
        let activeSection = 'dashboard';
        let activeSidebarView = 'patient-dashboard';
        
        // ==================== INITIALIZATION ====================
        async function initializeDashboard() {
            // Show loading state
            const patientSelect = document.getElementById('patientSelect');
            if (patientSelect) {
                patientSelect.innerHTML = '<option value="">Loading patients...</option>';
            }
            
            try {
                // Load patients data
                const patientsResponse = await fetch('../data/patients.json');
                if (patientsResponse.ok) {
                    patientsData = await patientsResponse.json();
                } else {
                    throw new Error('Failed to load patients');
                }
            } catch (error) {
                console.warn('Using fallback patients data:', error.message);
                patientsData = fallbackPatientsData;
            }
            
            try {
                // Load files data
                const filesResponse = await fetch('../data/files.json');
                if (filesResponse.ok) {
                    filesData = await filesResponse.json();
                } else {
                    throw new Error('Failed to load files');
                }
            } catch (error) {
                console.warn('Using fallback files data:', error.message);
                filesData = fallbackFilesData;
            }
            
            // Ensure data is available before rendering
            if (patientsData && patientsData.patients) {
                populatePatientSelector();
                renderPatientGrid();
            }
            
            if (filesData) {
                renderFolderTree();
                renderFileGrid();
            }
            
            // Update sidebar stats
            updateSidebarStats();
            
            console.log('Dashboard initialized with', patientsData?.patients?.length || 0, 'patients and', filesData?.files?.length || 0, 'files');
        }
        
        function populatePatientSelector() {
            const select = document.getElementById('patientSelect');
            if (!select || !patientsData || !patientsData.patients) {
                console.warn('Cannot populate patient selector');
                return;
            }
            
            // Clear existing options
            select.innerHTML = '<option value="">-- Select a Patient --</option>';
            
            patientsData.patients.forEach(patient => {
                const option = document.createElement('option');
                option.value = patient.id;
                option.textContent = `${patient.name} - ${patient.primaryDiagnosis}`;
                select.appendChild(option);
            });
            
            console.log('Patient selector populated with', patientsData.patients.length, 'patients');
        }
        
        function updateSidebarStats() {
            if (patientsData) {
                document.getElementById('sidebarPatientCount').textContent = patientsData.patients.length;
            }
            if (filesData) {
                document.getElementById('sidebarFileCount').textContent = filesData.files.length;
            }
        }
        
        // ==================== SIDEBAR NAVIGATION ====================
        function toggleSidebar() {
            const sidebar = document.getElementById('dashboardSidebarNav');
            if (sidebar) {
                sidebar.classList.toggle('collapsed');
            }
        }
        
        function toggleDashboardSidebar() {
            const sidebar = document.getElementById('dashboardSidebarNav');
            const mainContent = document.querySelector('.dashboard-main-content');
            if (sidebar) {
                sidebar.classList.toggle('collapsed');
            }
            if (mainContent) {
                mainContent.classList.toggle('expanded');
            }
        }
        
        function toggleScheduleSidebar() {
            const sidebar = document.getElementById('scheduleSidebarNav');
            const mainContent = document.querySelector('.schedule-main-content');
            if (sidebar) {
                sidebar.classList.toggle('collapsed');
            }
            if (mainContent) {
                mainContent.classList.toggle('expanded');
            }
        }
        
        function switchSidebarView(viewName) {
            activeSidebarView = viewName;
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar__item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.sidebar__item[data-view="${viewName}"]`)?.classList.add('active');
            
            // Hide all views
            document.getElementById('patientDashboardView').style.display = 'none';
            document.getElementById('patientListView').style.display = 'none';
            document.getElementById('filesView').style.display = 'none';
            
            // Show selected view
            if (viewName === 'patient-dashboard') {
                document.getElementById('patientDashboardView').style.display = 'block';
            } else if (viewName === 'patient-list') {
                document.getElementById('patientListView').style.display = 'block';
            } else if (viewName === 'files') {
                document.getElementById('filesView').style.display = 'block';
            }
        }
        
        // ==================== PATIENT DASHBOARD ====================
        function loadPatientDashboard(patientId) {
            if (!patientId || !patientsData) {
                document.getElementById('patientDashboardEmpty').style.display = 'flex';
                document.getElementById('patientDashboardContent').style.display = 'none';
                document.getElementById('exportPdfBtn').disabled = true;
                document.getElementById('addNoteBtn').disabled = true;
                return;
            }
            
            selectedPatient = patientsData.patients.find(p => p.id === patientId);
            if (!selectedPatient) return;
            
            // Show content, hide empty state
            document.getElementById('patientDashboardEmpty').style.display = 'none';
            document.getElementById('patientDashboardContent').style.display = 'flex';
            document.getElementById('exportPdfBtn').disabled = false;
            document.getElementById('addNoteBtn').disabled = false;
            
            // Update patient banner
            document.getElementById('patientAvatar').textContent = selectedPatient.name.charAt(0);
            document.getElementById('patientName').textContent = selectedPatient.name;
            document.getElementById('patientDiagnosis').textContent = selectedPatient.primaryDiagnosis;
            document.getElementById('patientAdmission').textContent = formatDate(selectedPatient.admissionDate);
            document.getElementById('patientPhysio').textContent = selectedPatient.physioAssigned;
            document.getElementById('patientStatus').textContent = selectedPatient.status.charAt(0).toUpperCase() + selectedPatient.status.slice(1);
            document.getElementById('patientStatus').className = `patient-banner__status ${selectedPatient.status}`;
            
            // Update KPIs
            const kpi = selectedPatient.kpiSnapshot;
            updateKPICard('mobility', kpi.mobilityScore, kpi.mobilityTrend);
            updateKPICard('adl', kpi.adlIndependence, kpi.adlTrend, '%');
            updateKPICard('adherence', kpi.therapyAdherence, kpi.adherenceTrend, '%');
            updateKPICard('pain', kpi.painLevel, kpi.painTrend, '/10');
            
            // Update notes
            document.getElementById('recentNotes').innerHTML = `<p class="note-text">${selectedPatient.recentNotes}</p>`;
            
            // Render charts
            renderPatientCharts(patientId);
        }
        
        function updateKPICard(type, value, trend, unit = '') {
            const valueEl = document.getElementById(`${type}Value`);
            const trendEl = document.getElementById(`${type}Trend`);
            const progressEl = document.getElementById(`${type}Progress`);
            
            if (valueEl) {
                if (unit) {
                    valueEl.innerHTML = `${value}<span class="kpi-card__unit">${unit}</span>`;
                } else {
                    valueEl.textContent = value;
                }
            }
            
            if (trendEl) {
                trendEl.className = `kpi-card__trend ${trend}`;
                let trendText = '';
                let trendIcon = '';
                
                if (trend === 'up') {
                    trendIcon = '<svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg>';
                    trendText = type === 'pain' ? '-2' : '+5%';
                } else if (trend === 'down') {
                    trendIcon = '<svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>';
                    trendText = type === 'pain' ? '-2' : '-3%';
                } else {
                    trendIcon = '<svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>';
                    trendText = '0%';
                }
                
                trendEl.innerHTML = trendIcon + trendText;
            }
            
            if (progressEl) {
                let progressValue = value;
                if (type === 'pain') {
                    progressValue = value * 10; // Convert 0-10 scale to percentage
                }
                progressEl.style.width = `${Math.min(progressValue, 100)}%`;
            }
        }
        
        function renderPatientCharts(patientId) {
            // Destroy existing charts
            Object.values(chartInstances).forEach(chart => chart.destroy());
            chartInstances = {};
            
            // Get time series data (use pat001 as default if no data)
            const timeSeriesKey = patientsData.patientTimeSeries[patientId] ? patientId : 'pat001';
            const timeSeries = patientsData.patientTimeSeries[timeSeriesKey];
            
            if (!timeSeries) return;
            
            const chartColors = {
                primary: '#0d9488',
                primaryLight: 'rgba(13, 148, 136, 0.1)',
                secondary: '#06b6d4',
                secondaryLight: 'rgba(6, 182, 212, 0.1)',
                danger: '#dc2626',
                dangerLight: 'rgba(220, 38, 38, 0.1)',
                success: '#059669'
            };
            
            // Mobility Progress Line Chart
            const mobilityCtx = document.getElementById('mobilityChart')?.getContext('2d');
            if (mobilityCtx && timeSeries.mobilityProgress) {
                chartInstances.mobility = new Chart(mobilityCtx, {
                    type: 'line',
                    data: {
                        labels: timeSeries.mobilityProgress.map(d => formatChartDate(d.date)),
                        datasets: [{
                            label: 'Mobility Score',
                            data: timeSeries.mobilityProgress.map(d => d.score),
                            borderColor: chartColors.primary,
                            backgroundColor: chartColors.primaryLight,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
            
            // Therapy Attendance Bar Chart
            const attendanceCtx = document.getElementById('attendanceChart')?.getContext('2d');
            if (attendanceCtx && timeSeries.therapyAttendance) {
                chartInstances.attendance = new Chart(attendanceCtx, {
                    type: 'bar',
                    data: {
                        labels: timeSeries.therapyAttendance.map(d => d.week),
                        datasets: [{
                            label: 'Attended',
                            data: timeSeries.therapyAttendance.map(d => d.attended),
                            backgroundColor: chartColors.primary,
                            borderColor: chartColors.primary,
                            borderWidth: 0
                        }, {
                            label: 'Missed',
                            data: timeSeries.therapyAttendance.map(d => d.missed),
                            backgroundColor: chartColors.dangerLight,
                            borderColor: chartColors.danger,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                stacked: true,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                stacked: true,
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
            
            // Strength Radar Chart
            const strengthCtx = document.getElementById('strengthChart')?.getContext('2d');
            if (strengthCtx && timeSeries.strengthMetrics && timeSeries.strengthMetrics.length > 0) {
                // Get the latest strength metrics
                const latestSm = timeSeries.strengthMetrics[timeSeries.strengthMetrics.length - 1];
                chartInstances.strength = new Chart(strengthCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Upper Limb', 'Lower Limb', 'Grip Strength'],
                        datasets: [{
                            label: 'Strength %',
                            data: [latestSm.upperLimb, latestSm.lowerLimb, latestSm.grip],
                            backgroundColor: chartColors.primaryLight,
                            borderColor: chartColors.primary,
                            borderWidth: 2,
                            pointBackgroundColor: chartColors.primary
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { stepSize: 25 }
                            }
                        }
                    }
                });
            }
            
            // Gait Speed Line Chart
            const gaitCtx = document.getElementById('gaitChart')?.getContext('2d');
            if (gaitCtx && timeSeries.gaitSpeed) {
                chartInstances.gait = new Chart(gaitCtx, {
                    type: 'line',
                    data: {
                        labels: timeSeries.gaitSpeed.map(d => formatChartDate(d.date)),
                        datasets: [{
                            label: 'Gait Speed (m/s)',
                            data: timeSeries.gaitSpeed.map(d => d.speed),
                            borderColor: chartColors.secondary,
                            backgroundColor: chartColors.secondaryLight,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 1.2,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
            
            // Pain Trend Area Chart
            const painCtx = document.getElementById('painChart')?.getContext('2d');
            if (painCtx && timeSeries.painTrend) {
                chartInstances.pain = new Chart(painCtx, {
                    type: 'line',
                    data: {
                        labels: timeSeries.painTrend.map(d => formatChartDate(d.date)),
                        datasets: [{
                            label: 'Pain Level',
                            data: timeSeries.painTrend.map(d => d.level),
                            borderColor: chartColors.danger,
                            backgroundColor: chartColors.dangerLight,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
        }
        
        function formatChartDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
        
        function exportPatientPDF() {
            if (!selectedPatient) return;
            alert(`Exporting PDF for ${selectedPatient.name}...\n\nThis feature would generate a comprehensive patient report including all KPIs and charts.`);
        }
        
        function addPatientNote() {
            if (!selectedPatient) return;
            const note = prompt(`Add a clinical note for ${selectedPatient.name}:`);
            if (note) {
                alert(`Note saved:\n"${note}"\n\nIn production, this would be saved to the database.`);
            }
        }
        
        // ==================== PATIENT LIST VIEW ====================
        function renderPatientGrid(filterStatus = 'all', searchQuery = '') {
            const grid = document.getElementById('patientGrid');
            if (!grid || !patientsData) return;
            
            let patients = patientsData.patients;
            
            // Apply status filter
            if (filterStatus !== 'all') {
                patients = patients.filter(p => p.status === filterStatus);
            }
            
            // Apply search filter
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                patients = patients.filter(p => 
                    p.name.toLowerCase().includes(query) ||
                    p.primaryDiagnosis.toLowerCase().includes(query) ||
                    p.physioAssigned.toLowerCase().includes(query)
                );
            }
            
            grid.innerHTML = patients.map(patient => `
                <div class="patient-card ${selectedPatientForList === patient.id ? 'active' : ''}" 
                     onclick="selectPatientForList('${patient.id}')">
                    <div class="patient-card__header">
                        <div class="patient-card__avatar">${patient.name.charAt(0)}</div>
                        <div class="patient-card__info">
                            <div class="patient-card__name">${patient.name}</div>
                            <div class="patient-card__diagnosis">${patient.primaryDiagnosis.split(' - ')[0]}</div>
                        </div>
                        <span class="patient-card__status ${patient.status}">${patient.status}</span>
                    </div>
                    <div class="patient-card__kpis">
                        <div class="patient-card__kpi">
                            <div class="patient-card__kpi-value">${patient.kpiSnapshot.mobilityScore}</div>
                            <div class="patient-card__kpi-label">Mobility</div>
                        </div>
                        <div class="patient-card__kpi">
                            <div class="patient-card__kpi-value">${patient.kpiSnapshot.adlIndependence}%</div>
                            <div class="patient-card__kpi-label">ADL</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function selectPatientForList(patientId) {
            selectedPatientForList = patientId;
            const patient = patientsData.patients.find(p => p.id === patientId);
            
            // Update active state
            document.querySelectorAll('.patient-card').forEach(card => {
                card.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Show profile panel
            renderPatientProfile(patient);
        }
        
        function renderPatientProfile(patient) {
            const panel = document.getElementById('patientProfilePanel');
            const emptyState = panel.querySelector('.patient-profile-panel__empty');
            const content = document.getElementById('patientProfileContent');
            
            emptyState.style.display = 'none';
            content.style.display = 'block';
            
            content.innerHTML = `
                <div class="profile-panel__header">
                    <div class="profile-panel__avatar">${patient.name.charAt(0)}</div>
                    <h3 class="profile-panel__name">${patient.name}</h3>
                    <p class="profile-panel__diagnosis">${patient.primaryDiagnosis}</p>
                </div>
                
                <div class="profile-panel__section">
                    <h4 class="profile-panel__section-title">Demographics</h4>
                    <div class="profile-panel__info-row">
                        <span class="profile-panel__info-label">Age</span>
                        <span class="profile-panel__info-value">${patient.age} years</span>
                    </div>
                    <div class="profile-panel__info-row">
                        <span class="profile-panel__info-label">Gender</span>
                        <span class="profile-panel__info-value">${patient.gender}</span>
                    </div>
                    <div class="profile-panel__info-row">
                        <span class="profile-panel__info-label">Blood Type</span>
                        <span class="profile-panel__info-value">${patient.bloodType}</span>
                    </div>
                    <div class="profile-panel__info-row">
                        <span class="profile-panel__info-label">Phone</span>
                        <span class="profile-panel__info-value">${patient.phone}</span>
                    </div>
                </div>
                
                <div class="profile-panel__section">
                    <h4 class="profile-panel__section-title">Medical Info</h4>
                    <div class="profile-panel__info-row">
                        <span class="profile-panel__info-label">Stroke Date</span>
                        <span class="profile-panel__info-value">${formatDate(patient.strokeDate)}</span>
                    </div>
                    <div class="profile-panel__info-row">
                        <span class="profile-panel__info-label">Admission</span>
                        <span class="profile-panel__info-value">${formatDate(patient.admissionDate)}</span>
                    </div>
                    <div class="profile-panel__info-row">
                        <span class="profile-panel__info-label">Physiotherapist</span>
                        <span class="profile-panel__info-value">${patient.physioAssigned}</span>
                    </div>
                </div>
                
                <div class="profile-panel__section">
                    <h4 class="profile-panel__section-title">Current KPIs</h4>
                    <div class="profile-panel__kpis">
                        <div class="profile-panel__kpi">
                            <div class="profile-panel__kpi-value">${patient.kpiSnapshot.mobilityScore}</div>
                            <div class="profile-panel__kpi-label">Mobility</div>
                        </div>
                        <div class="profile-panel__kpi">
                            <div class="profile-panel__kpi-value">${patient.kpiSnapshot.adlIndependence}%</div>
                            <div class="profile-panel__kpi-label">ADL</div>
                        </div>
                        <div class="profile-panel__kpi">
                            <div class="profile-panel__kpi-value">${patient.kpiSnapshot.therapyAdherence}%</div>
                            <div class="profile-panel__kpi-label">Adherence</div>
                        </div>
                        <div class="profile-panel__kpi">
                            <div class="profile-panel__kpi-value">${patient.kpiSnapshot.painLevel}/10</div>
                            <div class="profile-panel__kpi-label">Pain</div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-panel__actions">
                    <button class="btn btn--primary" onclick="viewPatientDashboard('${patient.id}')">View Dashboard</button>
                    <button class="btn btn--secondary" onclick="messagePatient('${patient.id}')">Message</button>
                </div>
            `;
        }
        
        function viewPatientDashboard(patientId) {
            document.getElementById('patientSelect').value = patientId;
            loadPatientDashboard(patientId);
            switchSidebarView('patient-dashboard');
        }
        
        function messagePatient(patientId) {
            showSection('messages');
            // In production, this would open the chat with the patient
            alert(`Opening chat with patient ${patientId}...`);
        }
        
        function filterPatientList(query) {
            const currentStatus = document.querySelector('.filter-btn.active')?.dataset.status || 'all';
            renderPatientGrid(currentStatus, query);
        }
        
        function filterPatientsByStatus(status) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.filter-btn[data-status="${status}"]`)?.classList.add('active');
            
            const query = document.getElementById('patientSearchInput')?.value || '';
            renderPatientGrid(status, query);
        }
        
        // ==================== FILES MANAGER VIEW ====================
        function renderFolderTree() {
            const list = document.getElementById('folderList');
            if (!list || !filesData) return;
            
            // Get root folders (no parent)
            const rootFolders = filesData.folders.filter(f => !f.parentId);
            
            let html = `
                <div class="folder-item ${!currentFolder ? 'active' : ''}" onclick="selectFolder(null)">
                    <span class="folder-item__icon"></span>
                    <span class="folder-item__name">All Files</span>
                    <span class="folder-item__count">${filesData.files.length}</span>
                </div>
            `;
            
            rootFolders.forEach(folder => {
                const subfolders = filesData.folders.filter(f => f.parentId === folder.id);
                
                html += `
                    <div class="folder-item ${currentFolder === folder.id ? 'active' : ''}" onclick="selectFolder('${folder.id}')">
                        <span class="folder-item__icon">${folder.icon}</span>
                        <span class="folder-item__name">${folder.name}</span>
                        <span class="folder-item__count">${folder.fileCount}</span>
                    </div>
                `;
                
                // Add subfolders
                subfolders.forEach(sub => {
                    html += `
                        <div class="folder-item folder-item--nested ${currentFolder === sub.id ? 'active' : ''}" onclick="selectFolder('${sub.id}')">
                            <span class="folder-item__icon">${sub.icon}</span>
                            <span class="folder-item__name">${sub.name}</span>
                            <span class="folder-item__count">${sub.fileCount}</span>
                        </div>
                    `;
                });
            });
            
            list.innerHTML = html;
        }
        
        function selectFolder(folderId) {
            currentFolder = folderId;
            renderFolderTree();
            renderFileGrid();
            updateBreadcrumb();
        }
        
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('fileBreadcrumb');
            if (!breadcrumb) return;
            
            if (!currentFolder) {
                breadcrumb.innerHTML = '<span class="breadcrumb-item active">All Files</span>';
            } else {
                const folder = filesData.folders.find(f => f.id === currentFolder);
                let html = '<span class="breadcrumb-item" onclick="selectFolder(null)">All Files</span>';
                
                if (folder.parentId) {
                    const parent = filesData.folders.find(f => f.id === folder.parentId);
                    html += `<span class="breadcrumb-separator">/</span>`;
                    html += `<span class="breadcrumb-item" onclick="selectFolder('${parent.id}')">${parent.name}</span>`;
                }
                
                html += `<span class="breadcrumb-separator">/</span>`;
                html += `<span class="breadcrumb-item active">${folder.name}</span>`;
                
                breadcrumb.innerHTML = html;
            }
        }
        
        function renderFileGrid(searchQuery = '') {
            const grid = document.getElementById('fileGrid');
            if (!grid || !filesData) return;
            
            let files = filesData.files;
            
            // Filter by folder
            if (currentFolder) {
                files = files.filter(f => f.folderId === currentFolder);
            }
            
            // Filter by search
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                files = files.filter(f => f.name.toLowerCase().includes(query));
            }
            
            grid.className = `file-grid ${fileViewMode === 'list' ? 'list-view' : ''}`;
            
            grid.innerHTML = files.map(file => {
                const icon = getFileIcon(file.type);
                const size = formatFileSize(file.size);
                const date = formatDate(file.modifiedAt);
                
                if (fileViewMode === 'list') {
                    return `
                        <div class="file-item" onclick="previewFile('${file.id}')">
                            <span class="file-item__icon">${icon}</span>
                            <div class="file-item__info">
                                <div class="file-item__name">${file.name}</div>
                                <div class="file-item__meta">${size}  ${date}</div>
                            </div>
                            <div class="file-item__actions">
                                <button class="file-action-btn" onclick="event.stopPropagation(); downloadFile('${file.id}')" title="Download">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                return `
                    <div class="file-item" onclick="previewFile('${file.id}')">
                        <span class="file-item__icon">${icon}</span>
                        <div class="file-item__name" title="${file.name}">${file.name}</div>
                        <div class="file-item__meta">${size}</div>
                    </div>
                `;
            }).join('');
            
            if (files.length === 0) {
                grid.innerHTML = '<div class="empty-state"><p>No files found</p></div>';
            }
        }
        
        function getFileIcon(type) {
            const icons = {
                'pdf': '',
                'docx': '',
                'xlsx': '',
                'video': '',
                'dicom': '',
                'default': ''
            };
            return icons[type] || icons.default;
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        function toggleFileView(view) {
            fileViewMode = view;
            document.querySelectorAll('.view-toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.view-toggle-btn[data-view="${view}"]`)?.classList.add('active');
            renderFileGrid();
        }
        
        function filterFiles(query) {
            renderFileGrid(query);
        }
        
        function previewFile(fileId) {
            const file = filesData.files.find(f => f.id === fileId);
            if (!file) return;
            alert(`Preview: ${file.name}\n\nType: ${file.type.toUpperCase()}\nSize: ${formatFileSize(file.size)}\nCreated by: ${file.createdBy}\nLast modified: ${formatDate(file.modifiedAt)}\n\nIn production, this would open a preview modal.`);
        }
        
        function downloadFile(fileId) {
            const file = filesData.files.find(f => f.id === fileId);
            if (!file) return;
            alert(`Downloading: ${file.name}\n\nIn production, this would trigger a file download.`);
        }
        
        function uploadFile() {
            alert('Upload File\n\nIn production, this would open a file picker dialog to upload documents to the current folder.');
        }
        
        // ==================== UTILITY FUNCTIONS ====================
        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        // Show/hide main sections with proper sidebar management
        function showSection(section) {
            // Hide all sections
            const dashboardSection = document.getElementById('dashboardSection');
            const scheduleSection = document.getElementById('scheduleSection');
            const profileSection = document.getElementById('profileSection');
            const messagesSection = document.getElementById('messagesSection');
            
            if (dashboardSection) dashboardSection.style.display = 'none';
            if (scheduleSection) scheduleSection.style.display = 'none';
            if (profileSection) profileSection.style.display = 'none';
            if (messagesSection) messagesSection.style.display = 'none';
            
            // Show the selected section
            try {
                if (section === 'dashboard') {
                    if (dashboardSection) dashboardSection.style.display = 'block';
                    // Reinitialize dashboard data if needed
                    if (!patientsData || !filesData) {
                        initializeDashboard();
                    }
                } else if (section === 'schedule') {
                    if (scheduleSection) scheduleSection.style.display = 'block';
                    // Initialize schedule and force default view to calendar
                    initializeScheduleView().then(() => {
                        // Ensure calendar view is displayed by default
                        switchScheduleView('calendar');
                    }).catch(err => {
                        console.error('Schedule init error:', err);
                        switchScheduleView('calendar');
                    });
                } else if (section === 'profile') {
                    if (profileSection) profileSection.style.display = 'block';
                    loadProfilePage();
                } else if (section === 'messages') {
                    if (messagesSection) messagesSection.style.display = 'block';
                    // Reset active chat and reinitialize
                    activeChat = null;
                    initializeChat();
                }
            } catch (error) {
                console.error('Error showing section:', section, error);
            }
            
            // Update active nav link
            document.querySelectorAll('.header-nav__link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find the clicked link based on section name
            const navLinks = document.querySelectorAll('.header-nav__link');
            navLinks.forEach(link => {
                if (link.textContent.toLowerCase().trim().includes(section)) {
                    link.classList.add('active');
                }
            });
            
            activeSection = section;
        }
        
        // ==================== SCHEDULE VIEW ====================
        let meetingsData = [];
        let selectedMeeting = null;
        let meetingMicMuted = false;
        let meetingCameraOff = false;
        let activeScheduleView = 'calendar';
        
        async function initializeScheduleView() {
            try {
                // Load calendar events
                const response = await fetch('../data/calendar-events.json');
                const data = await response.json();
                meetingsData = data.events || [];
                
                // If no events loaded, use static data
                if (meetingsData.length === 0) {
                    meetingsData = calendarEvents;
                }
                
                // Update sidebar stats
                updateScheduleStats();
                
                // Render calendar
                renderCalendar();
                
                // Render meetings list
                renderMeetingsList();
                
                // Render upcoming events
                renderUpcomingEventsFull();
                
                // Render consultations
                renderConsultations();
                
                console.log('Schedule view initialized with', meetingsData.length, 'events');
            } catch (error) {
                console.error('Failed to load calendar events:', error);
                // Use static calendar events as fallback
                meetingsData = calendarEvents;
                updateScheduleStats();
                renderCalendar();
                renderMeetingsList();
            }
        }
        
        function switchScheduleView(viewName) {
            activeScheduleView = viewName;
            
            // Update sidebar active state
            document.querySelectorAll('.schedule-sidebar-nav .sidebar__item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.sidebar__item[data-schedule-view="${viewName}"]`)?.classList.add('active');
            
            // Get all view elements with null checks
            const calendarView = document.getElementById('scheduleCalendarView');
            const meetingsView = document.getElementById('scheduleMeetingsView');
            const upcomingView = document.getElementById('scheduleUpcomingView');
            const consultationsView = document.getElementById('scheduleConsultationsView');
            
            // Hide all views (with null checks)
            if (calendarView) calendarView.style.display = 'none';
            if (meetingsView) meetingsView.style.display = 'none';
            if (upcomingView) upcomingView.style.display = 'none';
            if (consultationsView) consultationsView.style.display = 'none';
            
            // Show selected view
            try {
                if (viewName === 'calendar') {
                    if (calendarView) calendarView.style.display = 'block';
                    renderCalendar();
                } else if (viewName === 'meetings') {
                    if (meetingsView) meetingsView.style.display = 'block';
                    renderMeetingsList();
                } else if (viewName === 'upcoming') {
                    if (upcomingView) upcomingView.style.display = 'block';
                    renderUpcomingEventsFull();
                } else if (viewName === 'consultations') {
                    if (consultationsView) consultationsView.style.display = 'block';
                    renderConsultations();
                }
            } catch (error) {
                console.error('Error rendering schedule view:', viewName, error);
            }
        }
        
        function updateScheduleStats() {
            const meetings = meetingsData.filter(e => e.category === 'meeting' || e.category === 'consultation');
            const meetingsCountEl = document.getElementById('scheduleMeetingsCount');
            const eventsCountEl = document.getElementById('scheduleEventsCount');
            if (meetingsCountEl) meetingsCountEl.textContent = meetings.length;
            if (eventsCountEl) eventsCountEl.textContent = meetingsData.length;
        }
        
        function renderUpcomingEventsFull() {
            const container = document.getElementById('upcomingEventsFullList');
            if (!container) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const upcoming = meetingsData
                .filter(e => new Date(e.date) >= today)
                .sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time))
                .slice(0, 20);
            
            if (upcoming.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No upcoming events</p></div>';
                return;
            }
            
            container.innerHTML = upcoming.map(event => `
                <div class="upcoming-event-card ${event.category}">
                    <div class="upcoming-event-card__icon">${event.icon || ''}</div>
                    <div class="upcoming-event-card__content">
                        <h4 class="upcoming-event-card__title">${event.title}</h4>
                        <p class="upcoming-event-card__desc">${event.description || ''}</p>
                        <div class="upcoming-event-card__meta">
                            <span>${new Date(event.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</span>
                            <span>${event.time}</span>
                        </div>
                    </div>
                    <span class="upcoming-event-card__category">${event.category}</span>
                </div>
            `).join('');
        }
        
        function renderConsultations() {
            const container = document.getElementById('consultationsList');
            if (!container) return;
            
            const consultations = meetingsData
                .filter(e => e.category === 'consultation')
                .sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time));
            
            if (consultations.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No consultations scheduled</p></div>';
                return;
            }
            
            container.innerHTML = consultations.map(c => `
                <div class="consultation-card">
                    <div class="consultation-card__header">
                        <span class="consultation-card__icon"></span>
                        <span class="consultation-card__date">${new Date(c.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} at ${c.time}</span>
                    </div>
                    <h4 class="consultation-card__title">${c.title}</h4>
                    <p class="consultation-card__desc">${c.description || ''}</p>
                    ${c.participants ? `<div class="consultation-card__participants">Participants: ${c.participants.join(', ')}</div>` : ''}
                </div>
            `).join('');
        }
        
        function scheduleNewMeeting() {
            alert('Schedule New Meeting\n\nThis would open a meeting scheduler dialog.');
        }
        
        function renderMeetingsList() {
            const meetingsList = document.getElementById('meetingsList');
            if (!meetingsList) return;
            
            // Filter upcoming meetings (consultations and meetings)
            const today = new Date();
            const upcomingMeetings = meetingsData
                .filter(evt => {
                    const eventDate = new Date(evt.date);
                    return eventDate >= today && (evt.category === 'consultation' || evt.category === 'meeting');
                })
                .sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time))
                .slice(0, 10);
            
            if (upcomingMeetings.length === 0) {
                meetingsList.innerHTML = `
                    <div class="meetings-empty">
                        <svg width="32" height="32" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                        </svg>
                        <p>No upcoming meetings</p>
                    </div>
                `;
                return;
            }
            
            meetingsList.innerHTML = upcomingMeetings.map(meeting => {
                const meetingDate = new Date(meeting.date);
                const dateStr = meetingDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const isSelected = selectedMeeting?.id === meeting.id;
                
                return `
                    <div class="meeting-item ${isSelected ? 'active' : ''}" 
                         data-id="${meeting.id}"
                         onclick="selectMeeting('${meeting.id}')"
                         role="button"
                         tabindex="0"
                         aria-label="Meeting: ${meeting.title}">
                        <div class="meeting-item__icon ${meeting.category}">
                            ${meeting.category === 'consultation' ? '' : ''}
                        </div>
                        <div class="meeting-item__info">
                            <div class="meeting-item__title">${meeting.title}</div>
                            <div class="meeting-item__meta">
                                <span class="meeting-item__date">${dateStr}</span>
                                <span class="meeting-item__time">${meeting.time}</span>
                            </div>
                            <div class="meeting-item__participants">${meeting.participants?.slice(0, 2).join(', ') || 'No participants'}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function selectMeeting(meetingId) {
            selectedMeeting = meetingsData.find(m => m.id === meetingId);
            if (!selectedMeeting) return;
            
            // Update active state
            document.querySelectorAll('.meeting-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.meeting-item[data-id="${meetingId}"]`)?.classList.add('active');
            
            // Update meeting preview
            updateMeetingPreview();
        }
        
        function updateMeetingPreview() {
            const previewPane = document.getElementById('meetingPreviewPane');
            const emptyState = document.getElementById('meetingPreviewEmpty');
            const activePreview = document.getElementById('meetingPreviewActive');
            
            if (!selectedMeeting) {
                if (emptyState) emptyState.style.display = 'flex';
                if (activePreview) activePreview.style.display = 'none';
                return;
            }
            
            if (emptyState) emptyState.style.display = 'none';
            if (activePreview) activePreview.style.display = 'flex';
            
            // Update meeting info
            const meetingDate = new Date(selectedMeeting.date);
            document.getElementById('previewMeetingTitle').textContent = selectedMeeting.title;
            document.getElementById('previewMeetingDesc').textContent = selectedMeeting.description || 'No description';
            document.getElementById('previewMeetingTime').textContent = 
                `${meetingDate.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })} at ${selectedMeeting.time}`;
            document.getElementById('previewMeetingParticipants').textContent = 
                selectedMeeting.participants?.join(', ') || 'No participants';
            document.getElementById('previewMeetingLocation').textContent = selectedMeeting.location || 'Not specified';
            document.getElementById('previewMeetingDuration').textContent = `${selectedMeeting.duration || 30} min`;
        }
        
        function setupMeetingPreview() {
            // Initialize meeting controls with default state
            updateMicButton();
            updateCameraButton();
        }
        
        function toggleMeetingMic() {
            meetingMicMuted = !meetingMicMuted;
            updateMicButton();
        }
        
        function toggleMeetingCamera() {
            meetingCameraOff = !meetingCameraOff;
            updateCameraButton();
        }
        
        function updateMicButton() {
            const micBtn = document.getElementById('meetingMicBtn');
            if (!micBtn) return;
            
            if (meetingMicMuted) {
                micBtn.classList.add('muted');
                micBtn.setAttribute('aria-label', 'Unmute microphone');
                micBtn.innerHTML = `
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"/>
                        <path stroke="currentColor" stroke-width="2" d="M3 3l14 14"/>
                    </svg>
                `;
            } else {
                micBtn.classList.remove('muted');
                micBtn.setAttribute('aria-label', 'Mute microphone');
                micBtn.innerHTML = `
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"/>
                    </svg>
                `;
            }
        }
        
        function updateCameraButton() {
            const cameraBtn = document.getElementById('meetingCameraBtn');
            if (!cameraBtn) return;
            
            if (meetingCameraOff) {
                cameraBtn.classList.add('off');
                cameraBtn.setAttribute('aria-label', 'Turn on camera');
                cameraBtn.innerHTML = `
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                        <path stroke="currentColor" stroke-width="2" d="M3 3l14 14"/>
                    </svg>
                `;
            } else {
                cameraBtn.classList.remove('off');
                cameraBtn.setAttribute('aria-label', 'Turn off camera');
                cameraBtn.innerHTML = `
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                    </svg>
                `;
            }
        }
        
        function startMeeting() {
            if (!selectedMeeting) {
                alert('Please select a meeting first');
                return;
            }
            alert(`Starting meeting: ${selectedMeeting.title}\n\n[Integration Point: WebRTC/Video SDK would initialize here]`);
        }
        
        function showScheduleFallback() {
            const meetingsList = document.getElementById('meetingsList');
            if (meetingsList) {
                meetingsList.innerHTML = `
                    <div class="meetings-error">
                        <svg width="32" height="32" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                        <p>Unable to load meetings</p>
                        <button class="btn-retry" onclick="initializeScheduleView()">Retry</button>
                    </div>
                `;
            }
        }

        // Toggle notification dropdown
        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            const button = document.querySelector('.header-notification');
            dropdown.classList.toggle('active');
            button.classList.toggle('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('notificationDropdown');
            const button = document.querySelector('.header-notification');
            if (dropdown && !dropdown.contains(e.target) && !button.contains(e.target)) {
                dropdown.classList.remove('active');
                button.classList.remove('active');
            }
        });

        // Load notifications
        function loadNotifications() {
            const listContainer = document.getElementById('notificationList');
            listContainer.innerHTML = doctorNotifications.map(notif => `
                <div class="notification-item ${notif.unread ? 'unread' : ''}">
                    <div class="notification-item__icon ${notif.icon}">
                        ${notif.icon === 'info' ? '' : notif.icon === 'success' ? '' : notif.icon === 'warning' ? '' : ''}
                    </div>
                    <div class="notification-item__content">
                        <div class="notification-item__title">${notif.title}</div>
                        <div class="notification-item__description">${notif.description}</div>
                        <div class="notification-item__time">${notif.time}</div>
                    </div>
                </div>
            `).join('');
            
            // Update notification count
            const unreadCount = doctorNotifications.filter(n => n.unread).length;
            document.querySelector('.notification-dropdown__count').textContent = unreadCount;
        }

        // Calendar Functions
        function renderCalendar() {
            const calendarBody = document.getElementById('calendarBody');
            const calendarTitleEl = document.getElementById('calendarTitle');
            
            // Exit early if elements don't exist (schedule section not visible)
            if (!calendarBody || !calendarTitleEl) {
                return;
            }
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update calendar title
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            calendarTitleEl.textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1; // Adjust for Monday start
            
            // Get previous month's last days
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            
            calendarBody.innerHTML = '';
            
            let dayCounter = 1;
            let nextMonthCounter = 1;
            const totalCells = 42; // 6 rows x 7 days
            
            for (let i = 0; i < totalCells; i++) {
                const cell = document.createElement('div');
                cell.className = 'calendar-cell';
                
                if (i < startingDayOfWeek) {
                    // Previous month days
                    const day = prevMonthLastDay - startingDayOfWeek + i + 1;
                    cell.classList.add('other-month');
                    cell.innerHTML = `<div class="cell-date">${day}</div>`;
                } else if (dayCounter <= daysInMonth) {
                    // Current month days
                    const cellDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(dayCounter).padStart(2, '0')}`;
                    const today = new Date();
                    
                    if (dayCounter === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        cell.classList.add('today');
                    }
                    
                    cell.innerHTML = `<div class="cell-date">${dayCounter}</div>`;
                    
                    // Add events for this day
                    const dayEvents = calendarEvents.filter(evt => 
                        evt.date === cellDate && activeFilters.includes(evt.category)
                    );
                    
                    if (dayEvents.length > 0) {
                        const eventsContainer = document.createElement('div');
                        eventsContainer.className = 'cell-events';
                        
                        dayEvents.forEach(evt => {
                            const eventEl = document.createElement('div');
                            eventEl.className = `cell-event ${evt.category}`;
                            eventEl.innerHTML = `
                                <span class="event-icon">${evt.icon}</span>
                                <span class="event-title">${evt.title}</span>
                            `;
                            eventsContainer.appendChild(eventEl);
                        });
                        
                        cell.appendChild(eventsContainer);
                    }
                    
                    dayCounter++;
                } else {
                    // Next month days
                    cell.classList.add('other-month');
                    cell.innerHTML = `<div class="cell-date">${nextMonthCounter}</div>`;
                    nextMonthCounter++;
                }
                
                calendarBody.appendChild(cell);
            }
            
            // Update mini calendar
            renderMiniCalendar();
            
            // Update upcoming events
            renderUpcomingEvents();
            
            // Update today's events sidebar
            renderTodaysEvents();
        }
        
        // Render today's events in the right sidebar
        function renderTodaysEvents() {
            const todaysEventsList = document.getElementById('todaysEventsList');
            const todaysDateEl = document.getElementById('todaysDate');
            
            if (!todaysEventsList) return;
            
            // Get today's date
            const today = new Date(2025, 11, 16); // Dec 16, 2025 for demo
            const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            // Update date display
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            if (todaysDateEl) {
                todaysDateEl.textContent = `${monthNames[today.getMonth()]} ${today.getDate()}`;
            }
            
            // Get today's events
            const todaysEvents = calendarEvents.filter(evt => {
                const evtDate = evt.date;
                return evtDate === dateStr || evtDate === '2025-12-13'; // Include Dec 13 events for demo
            });
            
            if (todaysEvents.length === 0) {
                todaysEventsList.innerHTML = `
                    <div class="todays-events__empty">
                        <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <p>No events scheduled for today</p>
                    </div>
                `;
                return;
            }
            
            todaysEventsList.innerHTML = todaysEvents.slice(0, 5).map(evt => {
                const categoryClass = evt.category === 'meeting' ? 'meeting' : 
                                     evt.category === 'consultation' ? 'consultation' : 
                                     evt.category === 'research' ? 'research' : '';
                return `
                    <div class="today-event-item today-event-item--${categoryClass}">
                        <div class="today-event-item__time">${evt.time}</div>
                        <div class="today-event-item__info">
                            <div class="today-event-item__title">${evt.title}</div>
                            <div class="today-event-item__desc">${evt.description}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderMiniCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update mini calendar title
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                              'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            document.getElementById('miniCalendarTitle').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const startingDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            
            const grid = document.getElementById('miniCalendarGrid');
            grid.innerHTML = `
                <div class="mini-day-header">M</div>
                <div class="mini-day-header">T</div>
                <div class="mini-day-header">W</div>
                <div class="mini-day-header">T</div>
                <div class="mini-day-header">F</div>
                <div class="mini-day-header">S</div>
                <div class="mini-day-header">S</div>
            `;
            
            // Add empty cells for alignment
            for (let i = 0; i < startingDay; i++) {
                const cell = document.createElement('div');
                cell.className = 'mini-day empty';
                grid.appendChild(cell);
            }
            
            // Add days
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'mini-day';
                const cellDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                // Check if this day has events
                const hasEvents = calendarEvents.some(evt => evt.date === cellDate);
                if (hasEvents) {
                    cell.classList.add('has-events');
                }
                
                // Check if today
                const today = new Date();
                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    cell.classList.add('today');
                }
                
                cell.textContent = day;
                grid.appendChild(cell);
            }
        }

        function renderUpcomingEvents() {
            const today = new Date();
            const upcomingEvents = calendarEvents
                .filter(evt => {
                    const eventDate = new Date(evt.date);
                    return eventDate >= today && activeFilters.includes(evt.category);
                })
                .sort((a, b) => {
                    const dateA = new Date(a.date + 'T' + a.time);
                    const dateB = new Date(b.date + 'T' + b.time);
                    return dateA - dateB;
                })
                .slice(0, 10); // Show next 10 events
            
            const container = document.getElementById('upcomingEventsList');
            if (!container) return;
            container.innerHTML = upcomingEvents.map(evt => {
                const eventDate = new Date(evt.date);
                const dateStr = eventDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                return `
                    <div class="upcoming-event">
                        <div class="upcoming-event__icon ${evt.category}">${evt.icon}</div>
                        <div class="upcoming-event__content">
                            <div class="upcoming-event__title">${evt.title}</div>
                            <div class="upcoming-event__description">${evt.description}</div>
                            <div class="upcoming-event__time">${dateStr}  ${evt.time}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date(2025, 11, 13);
            renderCalendar();
        }

        function miniPrevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(); // This will update both calendars
        }

        function miniNextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(); // This will update both calendars
        }

        function changeView(view) {
            console.log('View changed to:', view);
            // Placeholder for view change functionality
        }

        function filterEvents(category) {
            const index = activeFilters.indexOf(category);
            if (index > -1) {
                activeFilters.splice(index, 1);
            } else {
                activeFilters.push(category);
            }
            renderCalendar();
        }

        function loadProfilePage() {
            let userData = JSON.parse(localStorage.getItem('neurotrack_user') || '{}');
            
            // Fallback profile data if localStorage is empty or invalid
            const fallbackUserProfile = {
                email: 'dokter@neurotrack.com',
                username: 'dokter',
                role: 'doctor',
                created_at: new Date().toISOString(),
                last_login: new Date().toISOString(),
                profile: {
                    fullName: 'Dr. Dokter Wijaya',
                    specialization: 'Neurology',
                    licenseId: 'MD-123456',
                    hospitalAffiliation: 'General Hospital',
                    department: 'Neuroscience Center',
                    phone: '+62 812-3456-7890',
                    mobile: '+62 856-9876-5432',
                    address: '123 Medical Plaza',
                    city: 'Jakarta, Indonesia'
                }
            };
            
            // Use fallback if no valid user data
            if (!userData || !userData.profile || Object.keys(userData.profile).length === 0) {
                userData = fallbackUserProfile;
            }
            
            // Helper function to safely set text content
            const setTextContent = (id, value) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            };
            
            try {
                
                // Basic Info
                setTextContent('profilePageName', userData.profile.fullName || 'Dr. Dokter');
                setTextContent('profilePageRole', `Senior ${(userData.profile.specialization || 'Neurologist').charAt(0).toUpperCase() + (userData.profile.specialization || 'neurologist').slice(1)}`);
                
                // Avatar Initial
                const firstLetter = (userData.profile.fullName || 'D').charAt(0).toUpperCase();
                setTextContent('profilePageInitial', firstLetter);
                
                // Contact Information
                setTextContent('profilePageEmail', userData.email || 'dokter@neurotrack.com');
                setTextContent('profilePagePhone', userData.profile.phone || '+62 812-3456-7890');
                setTextContent('profilePageMobile', userData.profile.mobile || '+62 856-9876-5432');
                
                // Personal Information
                setTextContent('profilePageFullName', userData.profile.fullName || 'Dr. Dokter Wijaya');
                setTextContent('profilePageLicense', userData.profile.licenseId || 'MD-123456');
                setTextContent('profilePageUsername', '@' + (userData.username || 'dokter'));
                
                // Professional Details
                setTextContent('profilePageSpecialization', (userData.profile.specialization || 'Neurology').charAt(0).toUpperCase() + (userData.profile.specialization || 'neurology').slice(1));
                setTextContent('profilePageHospital', userData.profile.hospitalAffiliation || 'General Hospital');
                setTextContent('profilePageDepartment', userData.profile.department || 'Neuroscience Center');
                
                // Location
                setTextContent('profilePageAddress', userData.profile.address || '123 Medical Plaza');
                setTextContent('profilePageCity', userData.profile.city || 'Jakarta, Indonesia');
                
                // Account Information
                if (userData.created_at) {
                    const createdAt = new Date(userData.created_at);
                    setTextContent('profilePageMemberSince', createdAt.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }));
                }
                
                if (userData.last_login) {
                    const lastLogin = new Date(userData.last_login);
                    const now = new Date();
                    const diffMs = now - lastLogin;
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    let lastLoginText;
                    if (diffMins < 1) {
                        lastLoginText = 'Just now';
                    } else if (diffMins < 60) {
                        lastLoginText = `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
                    } else if (diffMins < 1440) {
                        const hours = Math.floor(diffMins / 60);
                        lastLoginText = `${hours} hour${hours > 1 ? 's' : ''} ago`;
                    } else {
                        lastLoginText = lastLogin.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric' 
                        });
                    }
                    setTextContent('profilePageLastLogin', lastLoginText);
                } else {
                    setTextContent('profilePageLastLogin', 'Just now');
                }
                
                if (!userData.created_at) {
                    setTextContent('profilePageMemberSince', 'December 2025');
                }
            } catch (error) {
                console.error('Error loading profile page:', error);
            }
        }

        // Load user data from localStorage
        window.addEventListener('DOMContentLoaded', () => {
            const userData = JSON.parse(localStorage.getItem('neurotrack_user') || '{}');
            
            if (!userData.role || userData.role !== 'doctor') {
                // Redirect to login if not authenticated or wrong role
                window.location.href = './login.html';
                return;
            }
            
            // Update header with user data
            document.getElementById('userName').textContent = userData.profile?.fullName || 'Dr. Dokter';
            document.getElementById('userRole').textContent = 'Doctor';
            
            // Update avatar with first letter of name
            const firstLetter = (userData.profile?.fullName || 'D').charAt(0).toUpperCase();
            document.getElementById('userAvatar').textContent = firstLetter;
            
            // Load notifications
            loadNotifications();
            
            // Initialize patient dashboard, patient list, and files
            initializeDashboard();
            
            // Show dashboard by default
            showSection('dashboard');
        });

        function toggleUserMenu() {
            openProfileModal();
        }

        function openProfileModal() {
            const modal = document.getElementById('profileModal');
            const userData = JSON.parse(localStorage.getItem('neurotrack_user') || '{}');
            
            // Populate profile data
            if (userData && userData.profile) {
                // Basic Info
                document.getElementById('profileName').textContent = userData.profile.fullName || 'Dr. Dokter';
                document.getElementById('profileRoleBadge').textContent = 'Doctor';
                document.getElementById('profileEmail').textContent = userData.email || 'dokter@neurotrack.com';
                document.getElementById('profileUsername').textContent = userData.username || 'dokter';
                
                // Professional Info
                document.getElementById('profileSpecialization').textContent = 
                    (userData.profile.specialization || 'neurology').charAt(0).toUpperCase() + 
                    (userData.profile.specialization || 'neurology').slice(1);
                document.getElementById('profileLicense').textContent = userData.profile.licenseId || 'MD-123456';
                document.getElementById('profileHospital').textContent = userData.profile.hospitalAffiliation || 'General Hospital';
                
                // Activity Info
                if (userData.last_login) {
                    const lastLogin = new Date(userData.last_login);
                    const now = new Date();
                    const diffMs = now - lastLogin;
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    let lastLoginText;
                    if (diffMins < 1) {
                        lastLoginText = 'Just now';
                    } else if (diffMins < 60) {
                        lastLoginText = `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
                    } else if (diffMins < 1440) {
                        const hours = Math.floor(diffMins / 60);
                        lastLoginText = `${hours} hour${hours > 1 ? 's' : ''} ago`;
                    } else {
                        lastLoginText = lastLogin.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric' 
                        });
                    }
                    document.getElementById('profileLastLogin').textContent = lastLoginText;
                }
                
                if (userData.created_at) {
                    const createdAt = new Date(userData.created_at);
                    document.getElementById('profileCreatedAt').textContent = 
                        createdAt.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                }
                
                // Profile Photo Initial
                const firstLetter = (userData.profile.fullName || 'D').charAt(0).toUpperCase();
                document.getElementById('profilePhotoInitial').textContent = firstLetter;
            }
            
            // Show modal with animation
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        function handleLogout() {
            // Show confirmation dialog
            const confirmLogout = confirm('Are you sure you want to log out?');
            
            if (confirmLogout) {
                // Clear session data
                localStorage.removeItem('neurotrack_user');
                
                // Close modal
                closeProfileModal();
                
                // Redirect to login page
                setTimeout(() => {
                    window.location.href = './login.html';
                }, 200);
            }
        }

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeProfileModal();
            }
        });

        // ==================== CHAT SYSTEM ====================
        let chatData = null;
        let activeChat = null;
        let currentFilter = 'all';
        
        // Embedded fallback data for messages
        const fallbackChatData = {
            participants: [
                { id: "p1", type: "patient", name: "Alice Tan", role: "Post-Stroke Recovery", lastMessage: "Thank you for the advice!", lastMessageTime: new Date().toISOString(), unread: 2, online: true },
                { id: "p2", type: "patient", name: "Robert Chen", role: "Motor Function Rehab", lastMessage: "The exercises are getting easier", lastMessageTime: new Date(Date.now() - 3600000).toISOString(), unread: 0, online: false },
                { id: "p3", type: "patient", name: "Maria Santos", role: "Balance Recovery", lastMessage: "I walked 20 steps today!", lastMessageTime: new Date(Date.now() - 7200000).toISOString(), unread: 1, online: true },
                { id: "p4", type: "patient", name: "John Williams", role: "Speech Therapy", lastMessage: "My pronunciation is improving", lastMessageTime: new Date(Date.now() - 86400000).toISOString(), unread: 0, online: false },
                { id: "p5", type: "patient", name: "Susan Park", role: "Upper Limb Recovery", lastMessage: "Can we increase sessions?", lastMessageTime: new Date(Date.now() - 1800000).toISOString(), unread: 1, online: true },
                { id: "pt1", type: "physio", name: "Dr. Sarah Johnson", role: "Senior Physiotherapist", lastMessage: "Patient reports are ready", lastMessageTime: new Date(Date.now() - 900000).toISOString(), unread: 0, online: true },
                { id: "pt2", type: "physio", name: "Dr. Michael Lee", role: "Neuro Rehab Specialist", lastMessage: "New protocol for stroke", lastMessageTime: new Date(Date.now() - 5400000).toISOString(), unread: 3, online: true },
                { id: "pt3", type: "physio", name: "Dr. Emily Davis", role: "Occupational Therapist", lastMessage: "ADL assessment completed", lastMessageTime: new Date(Date.now() - 172800000).toISOString(), unread: 0, online: false }
            ],
            messages: {
                "p1": [
                    { id: "m1", from: "them", text: "Good morning, Doctor! I wanted to update you on my progress.", time: new Date(Date.now() - 7200000).toISOString(), read: true },
                    { id: "m2", from: "me", text: "Good morning, Alice! I'm glad to hear from you. How are you feeling today?", time: new Date(Date.now() - 7100000).toISOString(), sent: true, read: true },
                    { id: "m3", from: "them", text: "Much better! I've been doing the exercises you recommended. My left arm feels stronger.", time: new Date(Date.now() - 7000000).toISOString(), read: true },
                    { id: "m4", from: "me", text: "That's excellent progress! Make sure to continue the shoulder rotations 3 times daily.", time: new Date(Date.now() - 6900000).toISOString(), sent: true, read: true },
                    { id: "m5", from: "them", text: "I will, Doctor. Should I also continue the grip exercises?", time: new Date(Date.now() - 6800000).toISOString(), read: true },
                    { id: "m6", from: "me", text: "Yes, absolutely. The grip exercises are crucial for your fine motor recovery.", time: new Date(Date.now() - 6700000).toISOString(), sent: true, read: true },
                    { id: "m7", from: "them", text: "Thank you for the advice!", time: new Date(Date.now() - 6600000).toISOString(), read: false }
                ],
                "p2": [
                    { id: "m1", from: "them", text: "Hello Doctor, I hope you're having a good day.", time: new Date(Date.now() - 86400000).toISOString(), read: true },
                    { id: "m2", from: "me", text: "Hi Robert! Yes, thank you. How's the hand exercise routine going?", time: new Date(Date.now() - 86300000).toISOString(), sent: true, read: true },
                    { id: "m3", from: "them", text: "The exercises are getting easier. I can now hold objects for longer periods.", time: new Date(Date.now() - 86200000).toISOString(), read: true },
                    { id: "m4", from: "me", text: "That's wonderful progress! Can you try picking up smaller items now?", time: new Date(Date.now() - 86100000).toISOString(), sent: true, read: true },
                    { id: "m5", from: "them", text: "I tried picking up coins yesterday. Still challenging but getting better.", time: new Date(Date.now() - 86000000).toISOString(), read: true }
                ],
                "p3": [
                    { id: "m1", from: "them", text: "Doctor! I have exciting news!", time: new Date(Date.now() - 7500000).toISOString(), read: true },
                    { id: "m2", from: "me", text: "Tell me, Maria! What happened?", time: new Date(Date.now() - 7400000).toISOString(), sent: true, read: true },
                    { id: "m3", from: "them", text: "I walked 20 steps today without any assistance! ", time: new Date(Date.now() - 7300000).toISOString(), read: true },
                    { id: "m4", from: "me", text: "That's a fantastic milestone! I'm so proud of your dedication!", time: new Date(Date.now() - 7200000).toISOString(), sent: true, read: true },
                    { id: "m5", from: "them", text: "Thank you! The balance exercises really helped.", time: new Date(Date.now() - 7100000).toISOString(), read: false }
                ],
                "p4": [
                    { id: "m1", from: "them", text: "Good afternoon, Dr. Dokter.", time: new Date(Date.now() - 172800000).toISOString(), read: true },
                    { id: "m2", from: "me", text: "Good afternoon, John. How are the speech exercises going?", time: new Date(Date.now() - 172700000).toISOString(), sent: true, read: true },
                    { id: "m3", from: "them", text: "My pronunciation is improving. My family noticed the difference.", time: new Date(Date.now() - 172600000).toISOString(), read: true },
                    { id: "m4", from: "me", text: "That's great feedback! Keep practicing the tongue exercises daily.", time: new Date(Date.now() - 172500000).toISOString(), sent: true, read: true }
                ],
                "p5": [
                    { id: "m1", from: "them", text: "Hi Doctor, I wanted to ask about my therapy schedule.", time: new Date(Date.now() - 3600000).toISOString(), read: true },
                    { id: "m2", from: "me", text: "Of course, Susan. What would you like to discuss?", time: new Date(Date.now() - 3500000).toISOString(), sent: true, read: true },
                    { id: "m3", from: "them", text: "I feel like I'm making good progress. Can we increase sessions?", time: new Date(Date.now() - 3400000).toISOString(), read: true },
                    { id: "m4", from: "me", text: "I'm glad you're feeling motivated! Let me review your progress notes.", time: new Date(Date.now() - 3300000).toISOString(), sent: true, read: true },
                    { id: "m5", from: "them", text: "Thank you! I really want to recover faster.", time: new Date(Date.now() - 3200000).toISOString(), read: false }
                ],
                "pt1": [
                    { id: "m1", from: "them", text: "Good morning, Dr. Dokter. I've completed the patient assessments for this week.", time: new Date(Date.now() - 7200000).toISOString(), read: true },
                    { id: "m2", from: "me", text: "Thank you, Dr. Johnson. How are Alice and Maria progressing?", time: new Date(Date.now() - 7100000).toISOString(), sent: true, read: true },
                    { id: "m3", from: "them", text: "Both are showing excellent improvement. Alice's mobility score increased by 8 points.", time: new Date(Date.now() - 7000000).toISOString(), read: true },
                    { id: "m4", from: "me", text: "That's wonderful news! Please continue with the current therapy plan.", time: new Date(Date.now() - 6900000).toISOString(), sent: true, read: true },
                    { id: "m5", from: "them", text: "Will do. I'll send you the detailed reports shortly.", time: new Date(Date.now() - 6800000).toISOString(), read: true },
                    { id: "m6", from: "them", text: "Patient reports are ready for your review.", time: new Date(Date.now() - 900000).toISOString(), read: true }
                ],
                "pt2": [
                    { id: "m1", from: "them", text: "Dr. Dokter, I wanted to discuss the new rehabilitation protocol.", time: new Date(Date.now() - 10800000).toISOString(), read: true },
                    { id: "m2", from: "me", text: "Yes, Dr. Lee. I reviewed the literature you sent. It looks promising.", time: new Date(Date.now() - 10700000).toISOString(), sent: true, read: true },
                    { id: "m3", from: "them", text: "I think we should implement it for post-stroke patients starting next month.", time: new Date(Date.now() - 10600000).toISOString(), read: true },
                    { id: "m4", from: "me", text: "Agreed. Let's present it at the team meeting on Thursday.", time: new Date(Date.now() - 10500000).toISOString(), sent: true, read: true },
                    { id: "m5", from: "them", text: "Perfect. I'll prepare the presentation slides.", time: new Date(Date.now() - 10400000).toISOString(), read: true },
                    { id: "m6", from: "them", text: "New protocol for stroke rehabilitation is ready for review.", time: new Date(Date.now() - 5400000).toISOString(), read: false },
                    { id: "m7", from: "them", text: "I've also included outcome metrics from similar programs.", time: new Date(Date.now() - 5300000).toISOString(), read: false },
                    { id: "m8", from: "them", text: "Let me know when you have time to discuss.", time: new Date(Date.now() - 5200000).toISOString(), read: false }
                ],
                "pt3": [
                    { id: "m1", from: "them", text: "Hello Dr. Dokter, I've finished the ADL assessment for John Williams.", time: new Date(Date.now() - 259200000).toISOString(), read: true },
                    { id: "m2", from: "me", text: "Thank you, Dr. Davis. What are your findings?", time: new Date(Date.now() - 259100000).toISOString(), sent: true, read: true },
                    { id: "m3", from: "them", text: "He's showing improvement in self-care activities. Dressing score improved by 15%.", time: new Date(Date.now() - 259000000).toISOString(), read: true },
                    { id: "m4", from: "me", text: "Excellent! That aligns with his speech therapy progress.", time: new Date(Date.now() - 258900000).toISOString(), sent: true, read: true },
                    { id: "m5", from: "them", text: "ADL assessment completed. Full report uploaded to the system.", time: new Date(Date.now() - 172800000).toISOString(), read: true }
                ]
            }
        };

        async function initializeChat() {
            const participantsList = document.getElementById('participantsList');
            if (participantsList) {
                participantsList.innerHTML = '<div class="loading-state"><p>Loading conversations...</p></div>';
            }
            
            try {
                const response = await fetch('../data/messages.json');
                if (!response.ok) {
                    throw new Error(`Failed to load: ${response.status}`);
                }
                chatData = await response.json();
                
                if (!chatData || !chatData.participants || chatData.participants.length === 0) {
                    console.warn('Empty chat data, using fallback');
                    chatData = fallbackChatData;
                }
            } catch (error) {
                console.warn('Using fallback chat data:', error.message);
                chatData = fallbackChatData;
            }
            
            // Always render regardless of fetch success
            renderParticipants();
            setupSearch();
            setupComposer();
            
            // Reset chat to default state (no conversation selected)
            resetChatToDefaultState();
            
            console.log('Chat initialized with', chatData.participants.length, 'participants');
        }
        
        function resetChatToDefaultState() {
            // Show placeholder, hide active chat header
            const placeholder = document.querySelector('.chat-header__placeholder');
            const activeHeader = document.querySelector('.chat-header__active');
            const messagesContainer = document.getElementById('chatMessages');
            const composerInput = document.getElementById('messageInput');
            
            if (placeholder) placeholder.style.display = 'flex';
            if (activeHeader) activeHeader.style.display = 'none';
            if (messagesContainer) messagesContainer.innerHTML = '';
            if (composerInput) composerInput.value = '';
            
            // Remove active state from all participants
            document.querySelectorAll('.participant-item').forEach(item => {
                item.classList.remove('active');
            });
        }
        
        function showChatFallback(errorMessage) {
            const participantsList = document.getElementById('participantsList');
            if (participantsList) {
                participantsList.innerHTML = `
                    <div class="participants-error">
                        <svg width="40" height="40" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                        <p class="error-title">Unable to load conversations</p>
                        <p class="error-message">${errorMessage || 'Please try again later'}</p>
                        <button class="btn-retry" onclick="initializeChat()">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                            </svg>
                            Retry
                        </button>
                    </div>
                `;
            }
        }

        function renderParticipants(filterType = 'all') {
            if (!chatData || !chatData.participants) {
                showChatFallback('Participant data unavailable');
                return;
            }
            
            const participantsList = document.getElementById('participantsList');
            if (!participantsList) return;
            
            let participants = [...chatData.participants];
            
            // Apply filter
            if (filterType === 'patient') {
                participants = participants.filter(p => p.type === 'patient');
            } else if (filterType === 'physio') {
                participants = participants.filter(p => p.type === 'physio');
            }
            
            // Show message if no participants match filter
            if (participants.length === 0) {
                participantsList.innerHTML = `
                    <div class="participants-empty">
                        <svg width="32" height="32" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                        </svg>
                        <p>No ${filterType === 'all' ? 'conversations' : filterType + 's'} found</p>
                    </div>
                `;
                return;
            }
            
            // Sort by last message time (most recent first)
            participants.sort((a, b) => new Date(b.lastMessageTime) - new Date(a.lastMessageTime));
            
            participantsList.innerHTML = participants.map(participant => `
                <div class="participant-item ${activeChat === participant.id ? 'active' : ''}" 
                     data-id="${participant.id}" 
                     onclick="selectParticipant('${participant.id}')"
                     role="listitem"
                     tabindex="0"
                     aria-label="Chat with ${participant.name}${participant.unread > 0 ? ', ' + participant.unread + ' unread messages' : ''}">
                    <div class="participant-avatar ${participant.type}">
                        <span class="avatar-initial">${participant.name.charAt(0)}</span>
                        ${participant.online ? '<span class="online-dot" aria-label="Online"></span>' : ''}
                    </div>
                    <div class="participant-info">
                        <div class="participant-header">
                            <div class="participant-name">${participant.name}</div>
                            <div class="participant-time">${formatMessageTime(participant.lastMessageTime)}</div>
                        </div>
                        <div class="participant-role">${participant.role}</div>
                        <div class="participant-preview">
                            <span class="preview-text">${participant.lastMessage || 'No messages yet'}</span>
                            ${participant.unread > 0 ? `<span class="unread-badge" aria-label="${participant.unread} unread">${participant.unread}</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Add keyboard navigation
            setupParticipantKeyboardNav();
        }
        
        function setupParticipantKeyboardNav() {
            const items = document.querySelectorAll('.participant-item');
            items.forEach((item, index) => {
                item.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        item.click();
                    } else if (e.key === 'ArrowDown' && index < items.length - 1) {
                        e.preventDefault();
                        items[index + 1].focus();
                    } else if (e.key === 'ArrowUp' && index > 0) {
                        e.preventDefault();
                        items[index - 1].focus();
                    }
                });
            });
        }

        function selectParticipant(participantId) {
            activeChat = participantId;
            
            // Find participant data
            const participant = chatData.participants.find(p => p.id === participantId);
            if (!participant) return;
            
            // Clear unread count
            participant.unread = 0;
            
            // Update UI to show active chat
            document.querySelectorAll('.participant-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.participant-item[data-id="${participantId}"]`)?.classList.add('active');
            
            // Show chat header
            document.querySelector('.chat-header__placeholder').style.display = 'none';
            document.querySelector('.chat-header__active').style.display = 'flex';
            
            // Update chat header
            document.getElementById('chatName').textContent = participant.name;
            document.getElementById('chatStatus').textContent = participant.online ? 'Online' : 'Offline';
            document.getElementById('chatAvatarInitial').textContent = participant.name.charAt(0);
            
            // Load and display messages
            loadMessages(participantId);
            
            // Re-render participants to update unread badge
            renderParticipants(currentFilter);
        }

        function loadMessages(participantId) {
            const messagesContainer = document.getElementById('chatMessages');
            const messages = chatData.messages[participantId] || [];
            
            if (messages.length === 0) {
                messagesContainer.innerHTML = '<div class="no-messages">No messages yet</div>';
                return;
            }
            
            messagesContainer.innerHTML = messages.map((message, index) => {
                const isMe = message.from === 'me';
                const showDate = index === 0 || !isSameDay(message.time, messages[index - 1].time);
                
                return `
                    ${showDate ? `<div class="message-date">${formatDate(message.time)}</div>` : ''}
                    <div class="message ${isMe ? 'message--sent' : 'message--received'}">
                        <div class="message-bubble">
                            <div class="message-text">${message.text}</div>
                            <div class="message-meta">
                                <span class="message-time">${formatTime(message.time)}</span>
                                ${isMe ? `
                                    <span class="message-status">
                                        ${message.read ? 
                                            '<svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg><svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20" style="margin-left: -8px;"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>' 
                                            : '<svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>'}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Scroll to bottom
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }

        function sendMessage() {
            if (!activeChat) return;
            
            const input = document.getElementById('messageInput');
            const messageText = input.value.trim();
            
            if (!messageText) return;
            
            // Create new message object
            const newMessage = {
                id: `m${Date.now()}`,
                from: 'me',
                to: activeChat,
                text: messageText,
                time: new Date().toISOString(),
                sent: true,
                read: false
            };
            
            // Add to messages array
            if (!chatData.messages[activeChat]) {
                chatData.messages[activeChat] = [];
            }
            chatData.messages[activeChat].push(newMessage);
            
            // Update participant's last message
            const participant = chatData.participants.find(p => p.id === activeChat);
            if (participant) {
                participant.lastMessage = messageText;
                participant.lastMessageTime = newMessage.time;
            }
            
            // Clear input
            input.value = '';
            input.style.height = 'auto';
            
            // Reload messages
            loadMessages(activeChat);
            
            // Re-render participants
            renderParticipants(currentFilter);
        }

        function setupComposer() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            
            // Auto-resize textarea
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
            
            // Send on Enter (Shift+Enter for new line)
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Send button click
            sendButton.addEventListener('click', sendMessage);
        }

        function setupSearch() {
            const searchInput = document.getElementById('participantSearch');
            
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const participants = document.querySelectorAll('.participant-item');
                
                participants.forEach(item => {
                    const name = item.querySelector('.participant-name').textContent.toLowerCase();
                    const preview = item.querySelector('.preview-text').textContent.toLowerCase();
                    
                    if (name.includes(query) || preview.includes(query)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
            
            // Keyboard shortcut: / to focus search
            document.addEventListener('keydown', function(e) {
                if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    searchInput.focus();
                }
            });
        }

        function filterParticipants(type) {
            currentFilter = type;
            
            // Update filter tabs
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.filter-tab[data-filter="${type}"]`).classList.add('active');
            
            // Re-render participants
            renderParticipants(type);
        }

        // Utility functions
        function formatMessageTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m`;
            if (diffMins < 1440) return `${Math.floor(diffMins / 60)}h`;
            if (diffMins < 10080) return `${Math.floor(diffMins / 1440)}d`;
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (isSameDay(date, today)) return 'Today';
            if (isSameDay(date, yesterday)) return 'Yesterday';
            
            return date.toLocaleDateString('en-US', { 
                month: 'long', 
                day: 'numeric',
                year: date.getFullYear() !== today.getFullYear() ? 'numeric' : undefined
            });
        }

        function isSameDay(date1, date2) {
            const d1 = new Date(date1);
            const d2 = new Date(date2);
            return d1.getFullYear() === d2.getFullYear() &&
                   d1.getMonth() === d2.getMonth() &&
                   d1.getDate() === d2.getDate();
        }
        
        // ==================== PLACEHOLDER FUNCTIONS ====================
        // These functions are placeholders for future implementation
        
        function addNewEvent() {
            alert('Add New Event feature coming soon!');
        }
        
        function exportCalendar() {
            alert('Export Calendar feature coming soon!');
        }
        
        function setReminder() {
            alert('Set Reminder feature coming soon!');
        }
        
        function instantMeeting() {
            alert('Starting instant meeting...\n\nThis feature is coming soon!');
        }
        
        function filterUpcomingEvents(filter) {
            console.log('Filtering upcoming events by:', filter);
            // Implementation pending
        }
        
        function filterConsultations(filter) {
            console.log('Filtering consultations by:', filter);
            // Implementation pending
        }
        
        function scheduleConsultation() {
            alert('Schedule Consultation feature coming soon!');
        }
        
        function filterMeetings(filter) {
            console.log('Filtering meetings by:', filter);
            // Implementation pending
        }
        
        function markAllRead() {
            const unreadCountEl = document.getElementById('unreadCount');
            if (unreadCountEl) {
                unreadCountEl.textContent = '0';
            }
            alert('All messages marked as read!');
        }
        
        function startNewConversation() {
            alert('Start New Conversation feature coming soon!');
        }
        
        function viewBroadcasts() {
            alert('View Broadcasts feature coming soon!');
        }
    </script>
</body>
</html>
